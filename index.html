    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: 'LilitaOne';
            src: url('lilitaone.ttf') format('truetype');
        }

        body {
            font-family: 'LilitaOne', Arial, sans-serif;
            background: #301934;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .character-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .character {
            background: url('character-card.png') no-repeat center center;
            background-size: cover;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .character img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            margin: 10px 0 15px 0;
        }

        .character h3 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: black;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
            margin: 0 0 15px 0;
            order: -1;
        }

        .character p {
            color: black;
            font-weight: bold;
            margin: 5px 0;
        }

        .character.selected {
            background: url('character-selected.png') no-repeat center center;
            background-size: cover;
            border: none;
            transform: scale(1.05);
        }

        .character:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .special-ability {
            background: rgba(0, 0, 255, 0.15);
            border: 2px solid rgba(100, 149, 237, 0.5);
            color: black;
            padding: 12px;
            margin-top: 10px;
            border-radius: 12px;
            font-size: 0.9em;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .battle-arena {
            display: none; 
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            background: linear-gradient(to bottom, #87CEEB, #228B22);
            border-radius: 15px;
            margin-top: 20px;
            overflow: hidden;
        }

        .battle-arena.active {
            display: block;
        }

        .fighter {
            position: absolute;
            text-align: center;
            transition: all 0.3s ease;
        }

        .fighter img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            position: relative;
            z-index: 2;
        }

        .fighter::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            z-index: 1;
        }

        .health-bars-container {
            position: absolute;
            width: 150px; 
            padding: 5px;
            background: rgba(0,0,0,0.7);
            border-radius: 8px;
            color: white;
            font-family: 'LilitaOne', Arial, sans-serif;
            z-index: 100;
        }

        .health-bars-container.player {
            left: 20px;
            top: 20px;
        }

        .health-bars-container.enemy {
            right: 20px;
            top: 20px;
        }

        .health-bar-wrapper {
            margin: 5px 0;
        }

        .health-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0;
            font-size: 12px;
        }

        .health-bar-container {
            display: none;
        }

        .health-bar {
            display: none;
        }

        .battle-log {
            background: rgba(75, 0, 130, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            max-width: 800px;
            font-family: 'LilitaOne', Arial, sans-serif;
        }

        button {
            background: #FFD700;
            color: #301934;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            z-index: 10;
        }

        button:hover {
            background: #FFA500;
        }

        h1, h3, p, button {
            font-family: 'LilitaOne', Arial, sans-serif;
        }

        .battle-animation {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .selection-screen {
            transition: opacity 0.5s ease;
        }

        .selection-screen.hidden {
            display: none;
        }
        
        .type-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .filter-btn {
            background: #301934;
            color: white;
            border: 2px solid #FFD700;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #FFD700;
            color: #301934;
        }

        .class-icon {
            width: 24px;
            height: 24px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .fighter-icon {
            background-image: url('Class-Fighter.png');
        }

        .support-icon {
            background-image: url('Class-Support.png');
        }

        .tank-icon {
            background-image: url('Class-Tank.png');
        }

        .damage-icon {
            background-image: url('Class-Damage.png');  
        }

        .assassin-icon {
            background-image: url('Class-Assassin.png');
        }

        .character.filtered {
            display: none;
        }

        .minion {
            position: absolute;
            width: 60px;
            height: 60px;
            transition: all 0.3s ease;
            z-index: 3;
        }

        .minion img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .minion::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }

        .class-icon, .type-icon {
            width: 24px;
            height: 24px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .type-human {
            background-image: url('Type-Human.png');
        }

        .type-beastly {
            background-image: url('Type-Beastly.png');
        }

        .type-mechanical {
            background-image: url('Type-Mechanical.png');
        }

        .type-supernatural {
            background-image: url('Type-Supernatural.png');
        }

        /* Add new type filters styling */
        .type-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: center;
        }

        .guide-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #FFD700;
            color: #301934;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            font-family: 'LilitaOne', Arial, sans-serif;
            transition: all 0.3s;
        }

        .guide-button:hover {
            background: #FFA500;
        }

        .guide-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #301934;
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 15px;
            z-index: 1000;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .guide-modal.active {
            display: block;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #FFD700;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;  
            z-index: 999;
        }

        .modal-overlay.active {
            display: block;
        }
        
        .guide-icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin-right: 8px;
            margin-left: 8px;
        }

        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            background: url('mainmenu.png') no-repeat center center fixed;
            background-size: cover;
            color: white;
            text-align: center;
            position: relative;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        .main-menu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        .main-menu h1,
        .main-menu .league-info,
        .main-menu button {
            position: relative;
            z-index: 2;
        }

        .main-menu h1 {
            font-family: 'LilitaOne', Arial, sans-serif;
            font-size: 3rem;
            margin-bottom: 30px;
        }

        .main-menu button {
            background: #FFD700;
            color: #301934;
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .main-menu button:hover {
            background: #FFA500;
            transform: scale(1.05);
        }

        .hidden {
            display: none;
        }

        .battle-result {
            font-size: 2em;
            color: gold;
            text-align: center;
            margin: 20px 0;
            font-family: 'LilitaOne', Arial, sans-serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid gold;
        }

        .return-menu-btn {
            background: #FFD700;
            color: #301934;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            border: none;
            font-family: 'LilitaOne', Arial, sans-serif;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        .return-menu-btn:hover {
            background: #FFA500;
            transform: scale(1.05);
        }

        .league-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .league-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
        }

        .league-name {
            font-size: 1.5em;
            color: gold;
            margin-bottom: 15px;
        }

        .trophy-progress {
            width: 300px;
            height: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
            border: 2px solid gold;
        }

        .trophy-bar {
            height: 100%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            transition: width 0.5s ease;
        }

        .trophy-count {
            color: gold;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .league-menu {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%; 
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            border: 2px solid gold;
            border-radius: 10px;
            padding: 20px;
            z-index: 100;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .league-menu.active {
            display: block;
        }

        .league-menu h2 {
            color: gold;
            text-align: center;
            margin-bottom: 20px;
            font-family: 'LilitaOne', Arial, sans-serif;
        }

        .league-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
        }

        .league-item img {
            width: 50px;
            height: 50px;
            margin-right: 15px;
        }

        .league-item-details {
            flex: 1;
            padding: 5px;
        }

        .league-item-name {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 3px;
        }

        .league-item-trophies {
            color: white;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .league-reward {
            color: #FFD700;
            font-size: 0.9em;
            margin-top: 5px;
            font-style: italic;
        }

        .league-menu-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: gold;
            font-size: 24px;
            cursor: pointer;
        }

        .enemy-team-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            width: 100%;
            min-height: 100vh;
        }

        .enemy-team-selection.hidden {
            display: none;
        }

        .enemy-teams-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .enemy-team-option {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .enemy-team-option:hover {
            transform: scale(1.05);
        }

        .team-preview {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .team-character {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .team-character img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .currency-display {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .coins, .gems {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 20px;
            border: 2px solid gold;
        }

        .coins img, .gems img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        .coins-count, .gems-count {
            color: white;
            font-size: 1.2em;
        }

        .gems {
            border-color: #00ff00;
        }

        /* Add new shop and box styles */
        .shop-button {
            position: absolute;
            top: 20px;
            right: 120px;
            background: #FFD700;
            color: #301934;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            font-family: 'LilitaOne', Arial, sans-serif;
            transition: all 0.3s;
        }

        .shop-button:hover {
            background: #FFA500;
        }

        .shop-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #301934;
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 15px;
            z-index: 1000;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .shop-modal.active {
            display: block;
        }

        .box-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding: 0 20px;
        }

        .box-option {
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .box-option:hover {
            transform: scale(1.1);
        }

        .box-option img {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }

        .box-price {
            color: #FFD700;
            font-size: 1.2em;
            margin-top: 10px;
        }

        .box-opening-animation {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .box-opening-animation.active {
            display: flex;
        }

        .box-sprite {
            width: 200px;
            height: 200px;
            transition: transform 1s;
        }

        .box-sprite.opening {
            transform: scale(1.5) rotate(720deg);
        }

        .unlocked-character {
            display: none;
            text-align: center;
            color: #FFD700;
            font-size: 2em;
            margin-top: 20px;
        }

        .unlocked-character img {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin: 20px 0;
        }

        .character.locked {
            filter: grayscale(100%) brightness(30%);
            cursor: not-allowed;
        }

        .character.locked::after {
            content: "ðŸ”’";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
        }

        .reward-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
        }

        .reward-item img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .reward-item h3 {
            color: #FFD700;
            margin: 0;
        }

        .unlocked-character {
            width: 80%;
            max-width: 400px;
        }

        .free-coins {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid gold;
        }

        .claim-coins-btn {
            background: #FFD700;
            color: #301934;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            margin-top: 10px;
            font-family: 'LilitaOne', Arial, sans-serif;
            transition: all 0.3s;
        }

        .claim-coins-btn:disabled {
            background: #808080;
            cursor: not-allowed;
        }

        .claim-coins-btn:hover:not(:disabled) {
            background: #FFA500;
        }

        .free-coins-timer {
            color: gold;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .damage-number, .heal-number {
          position: absolute;
          animation: floatUp 1s ease-out;
          font-weight: bold;
          font-family: 'LilitaOne', Arial, sans-serif;
          pointer-events: none;
          z-index: 1000;
        }

        .damage-number {
          color: #ff4444;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .heal-number {
          color: #44ff44;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
          0% {
            transform: translateY(0);
            opacity: 1;
          }
          100% {
            transform: translateY(-50px);
            opacity: 0;
          }
        }
    </style>
</head>
<body>
    <div class="main-menu">
        <h1>Brawl Stars 3v3</h1>
        <div class="league-info">
            <img src="League1.png" alt="Current League" class="league-icon">
            <div class="league-name">Bronze League</div>
            <div class="trophy-progress">
                <div class="trophy-bar" style="width: 0%"></div>
            </div>
            <div class="trophy-count">0 / 100 Trophies</div>
            <div class="currency-display">
                <div class="coins">
                    <img src="Coins.png" alt="Coins">
                    <span class="coins-count">0</span>
                </div>
                <div class="gems">
                    <img src="Gems.png" alt="Gems">
                    <span class="gems-count">0</span>
                </div>
            </div>
        </div>
        <button id="startGameBtn">Classic</button>
        <button class="shop-button">Shop</button>
    </div>
    <div class="league-menu">
        <button class="league-menu-close">&#xd7;</button>
        <h2>Leagues &amp; Trophies</h2>
        <p style="color: gold; text-align: center; margin-bottom: 20px;">
            Note: At the end of each week, trophies are reset to the start of your previous league!<br>
            +25 Gems for reaching each new league!<br>
            +25 Gems per league on Trophy Reset!
        </p>
        <div class="league-item">
            <img src="League1.png" alt="Wooden League">
            <div class="league-item-details">
                <div class="league-item-name">Wooden League</div>
                <div class="league-item-trophies">0-99 Trophies</div>
                <div class="league-reward">Reward: Starting League</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League2.png" alt="Bronze League">
            <div class="league-item-details">
                <div class="league-item-name">Bronze League</div>
                <div class="league-item-trophies">100-299 Trophies</div>
                <div class="league-reward">Reward: Frank</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League3.png" alt="Silver League">
            <div class="league-item-details">
                <div class="league-item-name">Silver League</div>
                <div class="league-item-trophies">300-599 Trophies</div>
                <div class="league-reward">Reward: Mortis</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League4.png" alt="Gold League">
            <div class="league-item-details">
                <div class="league-item-name">Gold League</div>
                <div class="league-item-trophies">600-999 Trophies</div>
                <div class="league-reward">Reward: Tara</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League5.png" alt="Diamond League">
            <div class="league-item-details">
                <div class="league-item-name">Diamond League</div>
                <div class="league-item-trophies">1000-1499 Trophies</div>
                <div class="league-reward">Reward: Leon</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League6.png" alt="Crystal League">
            <div class="league-item-details">
                <div class="league-item-name">Crystal League</div>
                <div class="league-item-trophies">1500-1999 Trophies</div>
                <div class="league-reward">Reward: Crow</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League7.png" alt="Master League">
            <div class="league-item-details">
                <div class="league-item-name">Master League</div>
                <div class="league-item-trophies">2000-2499 Trophies</div>
                <div class="league-reward">Reward: Sandy</div>
            </div>
        </div>
        <div class="league-item">
            <img src="League8.png" alt="Legend League">
            <div class="league-item-details">
                <div class="league-item-name">Legend League</div>
                <div class="league-item-trophies">2500+ Trophies</div>
                <div class="league-reward">Reward: Spike</div>
            </div>
        </div>
    </div>
    <div class="enemy-team-selection hidden">
        <h1>Select Enemy Team</h1>
        <div class="enemy-teams-container">
            <div class="enemy-team-option">
                <h2>Team 1</h2>
                <div class="team-preview"></div>
            </div>
            <div class="enemy-team-option">
                <h2>Team 2</h2>
                <div class="team-preview"></div>
            </div>
            <div class="enemy-team-option">
                <h2>Team 3</h2>
                <div class="team-preview"></div>
            </div>
        </div>
    </div>
    <div class="selection-screen hidden">
        <button class="guide-button">Game Guide</button>
        <h1>Brawl Stars 3v3 Auto Battle</h1>
        <div class="type-filters">
            <button class="filter-btn" data-type="all">All Types</button>
            <button class="filter-btn" data-type="human">Human</button>
            <button class="filter-btn" data-type="mechanical">Mechanical</button>
            <button class="filter-btn" data-type="supernatural">Supernatural</button>
            <button class="filter-btn" data-type="beastly">Beastly</button>
        </div>
        <div class="class-filters">
            <button class="filter-btn" data-class="all">All</button>
            <button class="filter-btn" data-class="damage">Damage</button>
            <button class="filter-btn" data-class="fighter">Fighter</button>
            <button class="filter-btn" data-class="support">Support</button>
            <button class="filter-btn" data-class="tank">Tank</button>
            <button class="filter-btn" data-class="assassin">Assassin</button>
        </div>
        <div class="character-selection">
            <div class="character" data-type="colt" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Colt
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Colt-Default.png" alt="Colt">
                <p>HP: 3600<br>Attack: 420<br>Defense: 8</p>
                <div class="special-ability">Speed Shot: 30% chance for double attack</div>
            </div>
            <div class="character" data-type="shelly" data-class="fighter">
                <h3>
                    <div class="type-icon type-human"></div>
                    Shelly
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Shelly-Default.png" alt="Shelly">
                <p>HP: 3800<br>Attack: 380<br>Defense: 10</p>
                <div class="special-ability">Shell Shock: 25% chance to stun enemy</div>
            </div>
            <div class="character" data-type="poco" data-class="support">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Poco
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Poco-Default.png" alt="Poco">
                <p>HP: 3500<br>Attack: 280<br>Defense: 6<br>Healing: 700</p>
                <div class="special-ability">Da Capo: Healing also deals 200 damage to enemies</div>
            </div>
            <div class="character" data-type="dynamike" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Dynamike
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Dynamike-Default.png" alt="Dynamike">
                <p>HP: 2900<br>Attack: 460<br>Defense: 4</p>
                <div class="special-ability">Demolition: 20% chance for 2x damage</div>
            </div>
            <div class="character" data-type="frank" data-class="tank">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Frank
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="Frank-Default.png" alt="Frank">
                <p>HP: 5600<br>Attack: 360<br>Defense: 15</p>
                <div class="special-ability">Power Smash: 30% chance to stun and deal 200 extra damage</div>
            </div>
            <div class="character" data-type="spike" data-class="damage">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Spike
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Spike-Default.png" alt="Spike">
                <p>HP: 2400<br>Attack: 520<br>Defense: 3</p>
                <div class="special-ability">Thorns: Returns 15% damage taken</div>
            </div>
            <div class="character" data-type="nita" data-class="fighter">
                <h3>
                    <div class="type-icon type-human"></div>
                    Nita
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Nita-Default.png" alt="Nita">
                <p>HP: 4200<br>Attack: 340<br>Defense: 12</p>
                <div class="special-ability">Bear With Me: 20% chance to summon Bruce for extra attack</div>
            </div>
            <div class="character" data-type="bull" data-class="tank">
                <h3>
                    <div class="type-icon type-human"></div>
                    Bull
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="Bull-Default.png" alt="Bull">
                <p>HP: 4900<br>Attack: 440<br>Defense: 14</p>
                <div class="special-ability">Berserker: 40% damage boost at low health</div>
            </div>
            <div class="character" data-type="mortis" data-class="assassin">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Mortis
                    <div class="class-icon assassin-icon"></div>
                </h3>
                <img src="Mortis-Default.png" alt="Mortis"> 
                <p>HP: 3800<br>Attack: 400<br>Defense: 7</p>
                <div class="special-ability">Coiled Snake: 25% chance to strike twice</div>
            </div>
            <div class="character" data-type="pam" data-class="support">
                <h3>
                    <div class="type-icon type-human"></div>
                    Pam
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Pam-Default.png" alt="Pam">
                <p>HP: 4800<br>Attack: 320<br>Defense: 12<br>Healing: 500</p>
                <div class="special-ability">Healing Station: Heals nearby allies each turn</div>
            </div>
            <div class="character" data-type="edgar" data-class="assassin">
                <h3>
                    <div class="type-icon type-human"></div>
                    Edgar
                    <div class="class-icon assassin-icon"></div>
                </h3>
                <img src="Edgar-Default.png" alt="Edgar">
                <p>HP: 3200<br>Attack: 460<br>Defense: 5</p>
                <div class="special-ability">Life Leech: Heals for 25% of damage dealt</div>
            </div>
            <div class="character" data-type="el_primo" data-class="tank">
                <h3>
                    <div class="type-icon type-human"></div>
                    El Primo
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="El_Primo-Default.png" alt="El Primo">
                <p>HP: 5200<br>Attack: 400<br>Defense: 16</p>
                <div class="special-ability">Meteor Strike: 30% chance for area damage</div>
            </div>
            <div class="character" data-type="bea" data-class="damage">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Bea
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Bea-Default.png" alt="Bea">
                <p>HP: 3200<br>Attack: 480<br>Defense: 5</p>
                <div class="special-ability">Charged Shot: Next attack does 2x damage after hitting</div>
            </div>
            <div class="character" data-type="jessie" data-class="support">
                <h3>
                    <div class="type-icon type-human"></div>
                    Jessie
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Jessie-Default.png" alt="Jessie">
                <p>HP: 3600<br>Attack: 340<br>Defense: 8</p>
                <div class="special-ability">Scrappy: 25% chance to deploy turret for extra damage</div>
            </div>
            <div class="character" data-type="leon" data-class="assassin">
                <h3>
                    <div class="type-icon type-human"></div>
                    Leon
                    <div class="class-icon assassin-icon"></div>
                </h3>
                <img src="Leon-Default.png" alt="Leon">
                <p>HP: 3200<br>Attack: 500<br>Defense: 4</p>
                <div class="special-ability">Smoke Bomb: 30% chance to avoid damage</div>
            </div>
            <div class="character" data-type="bonnie" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Bonnie
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Bonnie-Default.png" alt="Bonnie">
                <p>HP: 3400<br>Attack: 440<br>Defense: 6</p>
                <div class="special-ability">Cannon Jump: 25% chance to evade damage and counter-attack</div>
            </div>
            <div class="character" data-type="barley" data-class="support">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Barley
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Barley-Default.png" alt="Barley">
                <p>HP: 3000<br>Attack: 300<br>Defense: 5<br>Healing: 400</p>
                <div class="special-ability">Sticky Mixture: 30% chance to reduce enemy damage by 30%</div>
            </div>
            <div class="character" data-type="tara" data-class="fighter">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Tara
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Tara-Default.png" alt="Tara">
                <p>HP: 3400<br>Attack: 460<br>Defense: 7</p>
                <div class="special-ability">Shadow Clone: 20% chance to create a copy that deals extra damage</div>
            </div>
            <div class="character" data-type="piper" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Piper
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Piper-Default.png" alt="Piper">
                <p>HP: 2800<br>Attack: 510<br>Defense: 4</p>
                <div class="special-ability">Sniper Shot: 35% chance for critical hit dealing 3x damage</div>
            </div>
            <div class="character" data-type="rico" data-class="fighter">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Rico
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Rico-Default.png" alt="Rico">
                <p>HP: 3400<br>Attack: 420<br>Defense: 6</p>
                <div class="special-ability">Bouncing Shots: 40% chance to hit second target for 50% damage</div>
            </div>
            <div class="character" data-type="bo" data-class="fighter">
                <h3>
                    <div class="type-icon type-human"></div>
                    Bo
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Bo-Default.png" alt="Bo">
                <p>HP: 4000<br>Attack: 380<br>Defense: 9</p>
                <div class="special-ability">Eagle Eye: 30% chance to spot weakness, ignoring 50% of target defense</div>
            </div>
            <div class="character" data-type="penny" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Penny
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Penny-Default.png" alt="Penny">
                <p>HP: 3200<br>Attack: 440<br>Defense: 6</p>
                <div class="special-ability">Pocket Mortar: 35% chance to deal area splash damage</div>
            </div>
            <div class="character" data-type="carl" data-class="fighter">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Carl
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Carl-Default.png" alt="Carl">
                <p>HP: 4200<br>Attack: 360<br>Defense: 10</p>
                <div class="special-ability">Spinning Axe: 35% chance to deal damage twice</div>
            </div>
            <div class="character" data-type="emz" data-class="damage">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    EMZ
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Emz-Default.png" alt="EMZ"> 
                <p>HP: 3400<br>Attack: 440<br>Defense: 6</p>
                <div class="special-ability">Bad Karma: 30% chance for damage over time</div>
            </div>
            <div class="character" data-type="grom" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Grom
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Grom-Default.png" alt="Grom">
                <p>HP: 3600<br>Attack: 420<br>Defense: 7</p>
                <div class="special-ability">X-Factor: 25% chance to deal splash damage</div>
            </div>
            <div class="character" data-type="sandy" data-class="support">
                <h3>
                    <div class="type-icon type-human"></div>
                    Sandy
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Sandy-Default.png" alt="Sandy">
                <p>HP: 3400<br>Attack: 360<br>Defense: 7</p>
                <div class="special-ability">Sandstorm: 30% chance to heal allies over time</div>
            </div>
            <div class="character" data-type="buzz" data-class="tank">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Buzz
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="Buzz-Default.png" alt="Buzz">
                <p>HP: 4600<br>Attack: 380<br>Defense: 13</p>
                <div class="special-ability">Torpedo Charge: 25% chance to stun and deal extra damage</div>
            </div>
            <div class="character" data-type="squeak" data-class="damage">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Squeak
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Squeak-Default.png" alt="Squeak">
                <p>HP: 3800<br>Attack: 380<br>Defense: 8</p>
                <div class="special-ability">Sticky Bombs: 30% chance to deal area damage</div>
            </div>
            <div class="character" data-type="sam" data-class="tank">
                <h3>
                    <div class="type-icon type-human"></div>
                    Sam
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="Sam-Default.png" alt="Sam">
                <p>HP: 4400<br>Attack: 420<br>Defense: 11</p>
                <div class="special-ability">Power Fist: 25% chance to stun and deal extra damage</div>
            </div>
            <div class="character" data-type="bibi" data-class="fighter">
                <h3>
                    <div class="type-icon type-human"></div>
                    Bibi
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Bibi-Default.png" alt="Bibi">
                <p>HP: 3600<br>Attack: 440<br>Defense: 7</p>
                <div class="special-ability">Home Run: 30% chance for critical hit</div>
            </div>
            <div class="character" data-type="8-bit" data-class="support">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    8-Bit
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="8-Bit-Default.png" alt="8-Bit">
                <p>HP: 4200<br>Attack: 380<br>Defense: 10</p>
                <div class="special-ability">Damage Boost: 30% chance for team damage boost</div>
            </div>
            <div class="character" data-type="angelo" data-class="fighter">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Angelo
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Angelo-Default.png" alt="Angelo">
                <p>HP: 3600<br>Attack: 440<br>Defense: 7</p>
                <div class="special-ability">Swamp Mode: 35% chance to poison target for 150 damage over 3 turns</div>
            </div>
            <div class="character" data-type="lily" data-class="assassin">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Lily
                    <div class="class-icon assassin-icon"></div>
                </h3>
                <img src="Lily-Default.png" alt="Lily">
                <p>HP: 3200<br>Attack: 280<br>Defense: 5</p>
                <div class="special-ability">Venomous Strike: 35% chance for critical hit and bleed damage</div>
            </div>
            <div class="character" data-type="brock" data-class="damage">
                <h3>
                    <div class="type-icon type-human"></div>
                    Brock
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Brock-Default.png" alt="Brock">
                <p>HP: 3400<br>Attack: 460<br>Defense: 5</p>
                <div class="special-ability">Rocket Rain: 35% chance to deal area damage</div>
            </div>
            <div class="character" data-type="crow" data-class="assassin">
                <h3>
                    <div class="type-icon type-beastly"></div>
                    Crow
                    <div class="class-icon assassin-icon"></div>
                </h3>
                <img src="Crow-Default.png" alt="Crow">
                <p>HP: 2800<br>Attack: 480<br>Defense: 4</p>
                <div class="special-ability">Poison Strike: 40% chance to poison enemies</div>
            </div>
            <div class="character" data-type="griff" data-class="damage">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Griff
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Griff-Default.png" alt="Griff">
                <p>HP: 3600<br>Attack: 420<br>Defense: 8</p>
                <div class="special-ability">Coin Storm: 30% chance for area damage</div>
            </div>
            <div class="character" data-type="darryl" data-class="tank">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Darryl
                    <div class="class-icon tank-icon"></div>
                </h3>
                <img src="Darryl-Default.png" alt="Darryl">
                <p>HP: 4800<br>Attack: 400<br>Defense: 14</p>
                <div class="special-ability">Rolling Thunder: Gets shield for 2 turns and deals 200 extra damage</div>
            </div>
            <div class="character" data-type="pearl" data-class="support">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Pearl
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Pearl-Default.png" alt="Pearl">
                <p>HP: 3200<br>Attack: 320<br>Defense: 6<br>Healing: 450</p>
                <div class="special-ability">Sweet Treats: 35% chance to heal allies and boost their damage</div>
            </div>
            <div class="character" data-type="lola" data-class="fighter">
                <h3>
                    <div class="type-icon type-human"></div>
                    Lola
                    <div class="class-icon fighter-icon"></div>
                </h3>
                <img src="Lola-Default.png" alt="Lola">
                <p>HP: 3800<br>Attack: 420<br>Defense: 8</p>
                <div class="special-ability">Ego Projection: 25% chance to create a copy that mimics attacks</div>
            </div>
            <div class="character" data-type="mr_p" data-class="support">
                <h3>
                    <div class="type-icon type-mechanical"></div>
                    Mr. P
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Mr_P-Default.png" alt="Mr. P">
                <p>HP: 3400<br>Attack: 320<br>Defense: 7</p>
                <div class="special-ability">Porter Post: 40% chance to summon a porter for chip damage</div>
            </div>
            <div class="character" data-type="draco" data-class="damage">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Draco
                    <div class="class-icon damage-icon"></div>
                </h3>
                <img src="Draco-Default.png" alt="Draco">
                <p>HP: 3600<br>Attack: 440<br>Defense: 6</p>
                <div class="special-ability">Dragon Breath: 30% chance to deal area damage over time</div>
            </div>
            <div class="character" data-type="gus" data-class="support">
                <h3>
                    <div class="type-icon type-supernatural"></div>
                    Gus
                    <div class="class-icon support-icon"></div>
                </h3>
                <img src="Gus-Default.png" alt="Gus">
                <p>HP: 3200<br>Attack: 360<br>Defense: 5<br>Healing: 400</p>
                <div class="special-ability">Healing Spirit: 35% chance to heal all allies</div>
            </div>
        </div>
        <button id="startBattle" disabled>Start Brawl!</button>
    </div>

    <div class="battle-arena">
        <!-- Characters will be positioned here dynamically -->
    </div>

    <div class="battle-log"></div>
    <button id="returnToSelect" style="display: none;">Return to Selection</button>

    <div class="modal-overlay"></div>
    <div class="guide-modal">
        <button class="modal-close">&#xd7;</button>
        <h2>Game Guide</h2>
        <h3>Character Types</h3>
        <div>
            <div>
                <img src="Type-Human.png" class="guide-icon">
                Human: Strong vs 
                <img src="Type-Mechanical.png" class="guide-icon"> 
                Mechanical, Weak vs 
                <img src="Type-Supernatural.png" class="guide-icon">
                Supernatural
            </div>
            <div>
                <img src="Type-Mechanical.png" class="guide-icon">
                Mechanical: Strong vs 
                <img src="Type-Beastly.png" class="guide-icon">
                Beastly, Weak vs 
                <img src="Type-Supernatural.png" class="guide-icon">
                Supernatural
            </div>
            <div>
                <img src="Type-Supernatural.png" class="guide-icon">
                Supernatural: Strong vs 
                <img src="Type-Mechanical.png" class="guide-icon">
                Mechanical &amp; 
                <img src="Type-Human.png" class="guide-icon">
                Human, Weak vs 
                <img src="Type-Beastly.png" class="guide-icon">
                Beastly
            </div>
            <div>
                <img src="Type-Beastly.png" class="guide-icon">
                Beastly: Strong vs 
                <img src="Type-Supernatural.png" class="guide-icon">
                Supernatural, Weak vs 
                <img src="Type-Mechanical.png" class="guide-icon">
                Mechanical
            </div>
        </div>
        <h3>Character Classes</h3>
        <ul>
            <li>
                <img src="Class-Damage.png" class="guide-icon">
                Damage: High damage output specialists
            </li>
            <li>
                <img src="Class-Fighter.png" class="guide-icon">
                Fighter: Balanced combat units
            </li>
            <li>
                <img src="Class-Support.png" class="guide-icon">
                Support: Team healing and utility
            </li>
            <li>
                <img src="Class-Tank.png" class="guide-icon">
                Tank: High health and defense
            </li>
            <li>
                <img src="Class-Assassin.png" class="guide-icon">
                Assassin: High burst damage but fragile
            </li>
        </ul>
        <h3>Combat</h3>
        <p>- Select 3 characters for your team<br>
        - Characters attack automatically each round<br>
        - Type advantages deal 50% more damage<br>
        - Type disadvantages deal 25% less damage<br>
        - Some characters can summon minions that assist in battle</p>
    </div>

    <div class="shop-modal">
        <button class="modal-close">&#xd7;</button>
        <h2>Shop</h2>
        <div class="free-coins">
            <h3>Daily Free Coins</h3>
            <button class="claim-coins-btn" onclick="claimDailyCoins()">Claim Free Coins</button>
            <div class="free-coins-timer"></div>
        </div>
        <div class="box-options">
            <div class="box-option" onclick="openBox(&apos;small&apos;)">
                <img src="Box.png" alt="Small Box">
                <div class="box-price">100 Coins</div>
            </div>
            <div class="box-option" onclick="openBox(&apos;big&apos;)">
                <img src="Box_Big.png" alt="Big Box">
                <div class="box-price">300 Coins</div>
            </div>
            <div class="box-option" onclick="openBox(&apos;mega&apos;)">
                <img src="Box_Mega.png" alt="Mega Box">
                <div class="box-price">500 Coins</div>
            </div>
            <div class="box-option" onclick="openBox(&apos;omega&apos;)">
                <img src="Box_Omega.png" alt="Omega Box">
                <div class="box-price">50 Gems</div>
            </div>
            <div class="box-option" onclick="openBox(&apos;ultra&apos;)">
                <img src="Box_Ultra.png" alt="Ultra Box">
                <div class="box-price">100 Gems</div>
            </div>
        </div>
    </div>

    <div class="box-opening-animation">
        <img src="Box.png" alt="Opening Box" class="box-sprite">
        <div class="unlocked-character"></div>
    </div>

    <script>const typeAdvantages = {
  human: {
    strong: ['mechanical'],
    weak: ['supernatural']
  },
  beastly: {
    strong: ['supernatural'],
    weak: ['mechanical']
  },
  mechanical: {
    strong: ['beastly'],
    weak: ['supernatural']
  },
  supernatural: {
    strong: ['mechanical', 'human'],
    weak: ['beastly']
  }
};
const characters = {
  colt: {
    hp: 3600,
    attack: 420,
    defense: 8,
    name: 'Colt',
    img: 'Colt-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Speed Shot',
      trigger: () => Math.random() < 0.3,
      effect: 'doubleAttack'
    }
  },
  shelly: {
    hp: 3800,
    attack: 380,
    defense: 10,
    name: 'Shelly',
    img: 'Shelly-Default.png',
    class: 'fighter',
    type: 'human',
    specialAbility: {
      name: 'Shell Shock',
      trigger: () => Math.random() < 0.25,
      effect: 'stun'
    }
  },
  poco: {
    hp: 3500,
    attack: 280,
    defense: 6,
    name: 'Poco',
    img: 'Poco-Default.png',
    class: 'support',
    type: 'supernatural',
    healing: 700,
    specialAbility: {
      name: 'Da Capo',
      damageAmount: 200,
      effect: 'healingDamage'
    }
  },
  dynamike: {
    hp: 2900,
    attack: 460,
    defense: 4,
    name: 'Dynamike',
    img: 'Dynamike-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Demolition',
      trigger: () => Math.random() < 0.2,
      effect: 'doubleDamage'
    }
  },
  frank: {
    hp: 5600,
    attack: 360,
    defense: 15,
    name: 'Frank',
    img: 'Frank-Default.png',
    class: 'tank',
    type: 'supernatural',
    specialAbility: {
      name: 'Power Smash',
      trigger: () => Math.random() < 0.30,
      effect: 'stun',
      stunDamage: 200
    }
  },
  spike: {
    hp: 2400,
    attack: 520,
    defense: 3,
    name: 'Spike',
    img: 'Spike-Default.png',
    class: 'damage',
    type: 'beastly',
    specialAbility: {
      name: 'Thorns',
      damageReturn: 0.15,
      effect: 'returnDamage'
    }
  },
  nita: {
    hp: 4200,
    attack: 340,
    defense: 12,
    name: 'Nita',
    img: 'Nita-Default.png',
    class: 'fighter',
    type: 'human',
    specialAbility: {
      name: 'Bear With Me',
      trigger: () => Math.random() < 0.2,
      effect: 'spawnMinion',
      minionData: {
        img: 'Nita_Minion-Default.png',
        damage: 300,
        duration: 3,
        name: 'Bruce'
      }
    }
  },
  bull: {
    hp: 4900,
    attack: 440,
    defense: 14,
    name: 'Bull',
    img: 'Bull-Default.png',
    class: 'tank',
    type: 'human',
    specialAbility: {
      name: 'Berserker',
      effect: 'lowHpBoost'
    }
  },
  mortis: {
    hp: 3800,
    attack: 400,
    defense: 7,
    name: 'Mortis',
    img: 'Mortis-Default.png',
    class: 'assassin',
    type: 'supernatural',
    specialAbility: {
      name: 'Coiled Snake',
      trigger: () => Math.random() < 0.25,
      effect: 'doubleStrike'
    }
  },
  pam: {
    hp: 4800,
    attack: 320,
    defense: 12,
    name: 'Pam',
    img: 'Pam-Default.png',
    class: 'support',
    type: 'human',
    healing: 500,
    specialAbility: {
      name: 'Healing Station',
      effect: 'teamHeal',
      healAmount: 200
    }
  },
  edgar: {
    hp: 3200,
    attack: 460,
    defense: 5,
    name: 'Edgar',
    img: 'Edgar-Default.png',
    class: 'assassin',
    type: 'human',
    specialAbility: {
      name: 'Life Leech',
      effect: 'lifeSteal',
      leechPercent: 0.25
    }
  },
  el_primo: {
    hp: 5200,
    attack: 400,
    defense: 16,
    name: 'El Primo',
    img: 'El_Primo-Default.png',
    class: 'tank',
    type: 'human',
    specialAbility: {
      name: 'Meteor Strike',
      trigger: () => Math.random() < 0.3,
      effect: 'areaDamage',
      areaDamage: 200
    }
  },
  bea: {
    hp: 3200,
    attack: 480,
    defense: 5,
    name: 'Bea',
    img: 'Bea-Default.png',
    class: 'damage',
    type: 'beastly',
    specialAbility: {
      name: 'Charged Shot',
      effect: 'chargedShot',
      isCharged: false
    }
  },
  jessie: {
    hp: 3600,
    attack: 340,
    defense: 8,
    name: 'Jessie',
    img: 'Jessie-Default.png',
    class: 'support',
    type: 'human',
    specialAbility: {
      name: 'Scrappy',
      trigger: () => Math.random() < 0.25,
      effect: 'spawnMinion',
      minionData: {
        img: 'Jessie_Minion-Default.png',
        damage: 200,
        duration: 3,
        name: 'Scrappy'
      }
    }
  },
  leon: {
    hp: 3200,
    attack: 500,
    defense: 4,
    name: 'Leon',
    img: 'Leon-Default.png',
    class: 'assassin',
    type: 'human',
    specialAbility: {
      name: 'Smoke Bomb',
      trigger: () => Math.random() < 0.3,
      effect: 'avoidDamage'
    }
  },
  bonnie: {
    hp: 3400,
    attack: 440,
    defense: 6,
    name: 'Bonnie',
    img: 'Bonnie-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Cannon Jump',
      trigger: () => Math.random() < 0.25,
      effect: 'evadeAndCounter',
      counterDamage: 300
    }
  },
  barley: {
    hp: 3000,
    attack: 300,
    defense: 5,
    name: 'Barley',
    img: 'Barley-Default.png',
    class: 'support',
    type: 'mechanical',
    healing: 400,
    specialAbility: {
      name: 'Sticky Mixture',
      trigger: () => Math.random() < 0.30,
      effect: 'reduceDamage',
      damageReduction: 0.3
    }
  },
  tara: {
    hp: 3400,
    attack: 460,
    defense: 7,
    name: 'Tara',
    img: 'Tara-Default.png',
    class: 'fighter',
    type: 'supernatural',
    specialAbility: {
      name: 'Shadow Clone',
      trigger: () => Math.random() < 0.2,
      effect: 'shadowClone',
      cloneDamage: 230
    }
  },
  piper: {
    hp: 2800,
    attack: 510,
    defense: 4,
    name: 'Piper',
    img: 'Piper-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Sniper Shot',
      trigger: () => Math.random() < 0.35,
      effect: 'criticalHit',
      critMultiplier: 3
    }
  },
  rico: {
    hp: 3400,
    attack: 420,
    defense: 6,
    name: 'Rico',
    img: 'Rico-Default.png',
    class: 'fighter',
    type: 'mechanical',
    specialAbility: {
      name: 'Bouncing Shots',
      trigger: () => Math.random() < 0.4,
      effect: 'bounceAttack',
      bounceMultiplier: 0.5
    }
  },
  bo: {
    hp: 4000,
    attack: 380,
    defense: 9,
    name: 'Bo',
    img: 'Bo-Default.png',
    class: 'fighter',
    type: 'human',
    specialAbility: {
      name: 'Eagle Eye',
      trigger: () => Math.random() < 0.3,
      effect: 'defenseBreak',
      defenseBreakAmount: 0.5
    }
  },
  penny: {
    hp: 3200,
    attack: 440,
    defense: 6,
    name: 'Penny',
    img: 'Penny-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Pocket Mortar',
      trigger: () => Math.random() < 0.35,
      effect: 'spawnMinion',
      minionData: {
        img: 'Penny_Minion-Default.png',
        damage: 250,
        duration: 2,
        name: 'Mortar'
      }
    }
  },
  sandy: {
    hp: 3400,
    attack: 360,
    defense: 7,
    name: 'Sandy',
    img: 'Sandy-Default.png',
    class: 'support',
    type: 'human',
    specialAbility: {
      name: 'Sandstorm',
      trigger: () => Math.random() < 0.30,
      effect: 'teamHeal',
      healAmount: 300
    }
  },
  buzz: {
    hp: 4600,
    attack: 380,
    defense: 13,
    name: 'Buzz',
    img: 'Buzz-Default.png',
    class: 'tank',
    type: 'beastly',
    specialAbility: {
      name: 'Torpedo Charge',
      trigger: () => Math.random() < 0.25,
      effect: 'stun',
      stunDamage: 200
    }
  },
  squeak: {
    hp: 3800,
    attack: 380,
    defense: 8,
    name: 'Squeak',
    img: 'Squeak-Default.png',
    class: 'damage',
    type: 'beastly',
    specialAbility: {
      name: 'Sticky Bombs',
      trigger: () => Math.random() < 0.30,
      effect: 'areaDamage',
      areaDamage: 250
    }
  },
  sam: {
    hp: 4400,
    attack: 420,
    defense: 11,
    name: 'Sam',
    img: 'Sam-Default.png',
    class: 'tank',
    type: 'human',
    specialAbility: {
      name: 'Power Fist',
      trigger: () => Math.random() < 0.25,
      effect: 'stun',
      stunDamage: 180
    }
  },
  bibi: {
    hp: 3600,
    attack: 440,
    defense: 7,
    name: 'Bibi',
    img: 'Bibi-Default.png',
    class: 'fighter',
    type: 'human',
    specialAbility: {
      name: 'Home Run',
      trigger: () => Math.random() < 0.30,
      effect: 'criticalHit',
      critMultiplier: 2
    }
  },
  '8-bit': {
    hp: 4200,
    attack: 380,
    defense: 10,
    name: '8-Bit',
    img: '8-Bit-Default.png',
    class: 'support',
    type: 'mechanical',
    specialAbility: {
      name: 'Damage Boost',
      effect: 'teamDamageBoost',
      trigger: () => Math.random() < 0.3,
      boostAmount: 1.4
    }
  },
  angelo: {
    hp: 3600,
    attack: 440,
    defense: 7,
    name: 'Angelo',
    img: 'Angelo-Default.png',
    class: 'fighter',
    type: 'beastly',
    specialAbility: {
      name: 'Swamp Mode',
      trigger: () => Math.random() < 0.35,
      effect: 'poisonAttack',
      duration: 3,
      poisonAmount: 150
    }
  },
  lily: {
    hp: 3200,
    attack: 280,
    defense: 5,
    name: 'Lily',
    img: 'Lily-Default.png',
    class: 'assassin',
    type: 'supernatural',
    specialAbility: {
      name: 'Venomous Strike',
      effect: 'criticalBleedDamage',
      trigger: () => Math.random() < 0.35,
      critMultiplier: 3,
      bleedAmount: 250,
      duration: 2
    }
  },
  brock: {
    hp: 3400,
    attack: 460,
    defense: 5,
    name: 'Brock',
    img: 'Brock-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'Rocket Rain',
      trigger: () => Math.random() < 0.35,
      effect: 'areaDamage',
      areaDamage: 240
    }
  },
  crow: {
    hp: 2800,
    attack: 480,
    defense: 4,
    name: 'Crow',
    img: 'Crow-Default.png',
    class: 'assassin',
    type: 'beastly',
    specialAbility: {
      name: 'Poison Strike',
      trigger: () => Math.random() < 0.4,
      effect: 'bleedDamage',
      bleedAmount: 150,
      duration: 3
    }
  },
  griff: {
    hp: 3600,
    attack: 420,
    defense: 8,
    name: 'Griff',
    img: 'Griff-Default.png',
    class: 'damage',
    type: 'mechanical',
    specialAbility: {
      name: 'Coin Storm',
      trigger: () => Math.random() < 0.3,
      effect: 'areaDamage',
      areaDamage: 280
    }
  },
  carl: {
    hp: 4200,
    attack: 360,
    defense: 10,
    name: 'Carl',
    img: 'Carl-Default.png',
    class: 'fighter',
    type: 'mechanical',
    specialAbility: {
      name: 'Spinning Axe',
      trigger: () => Math.random() < 0.35,
      effect: 'doubleStrike'
    }
  },
  emz: {
    hp: 3400,
    attack: 440,
    defense: 6,
    name: 'EMZ',
    img: 'Emz-Default.png',
    class: 'damage',
    type: 'supernatural',
    specialAbility: {
      name: 'Bad Karma',
      trigger: () => Math.random() < 0.30,
      effect: 'bleedDamage',
      bleedAmount: 180,
      duration: 3
    }
  },
  grom: {
    hp: 3600,
    attack: 420,
    defense: 7,
    name: 'Grom',
    img: 'Grom-Default.png',
    class: 'damage',
    type: 'human',
    specialAbility: {
      name: 'X-Factor',
      trigger: () => Math.random() < 0.25,
      effect: 'areaDamage',
      areaDamage: 220
    }
  },
  darryl: {
    hp: 4800,
    attack: 400,
    defense: 14,
    name: 'Darryl',
    img: 'Darryl-Default.png',
    class: 'tank',
    type: 'mechanical',
    specialAbility: {
      name: 'Rolling Thunder',
      effect: 'shieldAndDamage',
      trigger: () => Math.random() < 0.30,
      shieldDuration: 2,
      extraDamage: 200
    }
  },
  pearl: {
    hp: 3200,
    attack: 320,
    defense: 6,
    name: 'Pearl',
    img: 'Pearl-Default.png',
    class: 'support',
    type: 'mechanical',
    healing: 450,
    specialAbility: {
      name: 'Sweet Treats',
      trigger: () => Math.random() < 0.35,
      effect: 'teamBuffHeal',
      healAmount: 300,
      damageBoost: 1.3
    }
  },
  lola: {
    hp: 3800,
    attack: 420,
    defense: 8,
    name: 'Lola',
    img: 'Lola-Default.png',
    class: 'fighter',
    type: 'human',
    specialAbility: {
      name: 'Ego Projection',
      trigger: () => Math.random() < 0.25,
      effect: 'mirrorAttack',
      mirrorMultiplier: 0.8
    }
  },
  mr_p: {
    hp: 3400,
    attack: 320,
    defense: 7,
    name: 'Mr. P',
    img: 'Mr_P-Default.png',
    class: 'support',
    type: 'mechanical',
    specialAbility: {
      name: 'Porter Post',
      trigger: () => Math.random() < 0.4,
      effect: 'spawnMinion',
      minionData: {
        img: 'Mr_P_Minion-Default.png',
        damage: 150,
        duration: 4,
        name: 'Porter'
      }
    }
  },
  draco: {
    hp: 3600,
    attack: 440,
    defense: 6,
    name: 'Draco',
    img: 'Draco-Default.png',
    class: 'damage',
    type: 'beastly',
    specialAbility: {
      name: 'Dragon Breath',
      trigger: () => Math.random() < 0.3,
      effect: 'areaDamage',
      areaDamage: 200,
      duration: 3
    }
  },
  gus: {
    hp: 3200,
    attack: 360,
    defense: 5,
    name: 'Gus',
    img: 'Gus-Default.png',
    class: 'support',
    type: 'supernatural',
    healing: 400,
    specialAbility: {
      name: 'Healing Spirit',
      trigger: () => Math.random() < 0.35,
      effect: 'singleTargetHeal',
      healAmount: 350,
      shieldAmount: 200,
      shieldDuration: 2
    }
  }
};
characters.sam.type = 'human';
characters.angelo.type = 'beastly';
characters.griff.type = 'mechanical';
let enemyTeamOptions = [];
function generateEnemyTeams() {
  enemyTeamOptions = [];
  const container = document.querySelector('.enemy-teams-container');
  const teamPreviews = container.querySelectorAll('.team-preview');
  for (let i = 0; i < 3; i++) {
    const teamOption = [];
    const usedCharacters = new Set();
    while (teamOption.length < 3) {
      const availableCharacters = Object.values(characters);
      let randomChar;
      do {
        randomChar = availableCharacters[Math.floor(Math.random() * availableCharacters.length)];
      } while (usedCharacters.has(randomChar.name));
      usedCharacters.add(randomChar.name);
      teamOption.push({
        ...randomChar
      });
    }
    enemyTeamOptions.push(teamOption);
    const preview = teamPreviews[i];
    preview.innerHTML = '';
    teamOption.forEach(char => {
      preview.innerHTML += `
                                <div class="team-character">
                                    <img src="${char.img}" alt="${char.name}">
                                    <span>${char.name}</span>
                                </div>
                            `;
    });
  }
  document.querySelectorAll('.enemy-team-option').forEach((option, index) => {
    option.onclick = () => {
      enemyTeam = enemyTeamOptions[index];
      document.querySelector('.enemy-team-selection').classList.add('hidden');
      document.querySelector('.selection-screen').classList.remove('hidden');
    };
  });
}
let trophyCount = parseInt(localStorage.getItem('trophies') || '0');
const LEAGUE_THRESHOLDS = [0, 100, 300, 600, 1000, 1500, 2000, 2500];
const LEAGUE_NAMES = ['Wooden League', 'Bronze League', 'Silver League', 'Gold League', 'Diamond League', 'Crystal League', 'Master League', 'Legend League'];
const LEAGUE_ICONS = ['League1.png', 'League2.png', 'League3.png', 'League4.png', 'League5.png', 'League6.png', 'League7.png', 'League8.png'];
const LEAGUE_REWARDS = {
  'Bronze League': 'frank',
  'Silver League': 'mortis',
  'Gold League': 'tara',
  'Diamond League': 'leon',
  'Crystal League': 'crow',
  'Master League': 'sandy',
  'Legend League': 'spike'
};
const TROPHIES_PER_WIN = 20;
const COINS_PER_WIN = 50;
const COINS_PER_LOSS = 20;
const GEMS_PER_LEAGUE = 25;
const ONE_WEEK_MS = 7 * 24 * 60 * 60 * 1000;
let coinCount = parseInt(localStorage.getItem('coins') || '300');
let gemCount = parseInt(localStorage.getItem('gems') || '0');
const UNLOCKED_CHARACTERS = new Set(JSON.parse(localStorage.getItem('unlockedChars') || '["colt", "shelly", "poco", "dynamike"]'));
const BOX_PRICES = {
  small: 100,
  big: 300,
  mega: 500,
  omega: 50,
  ultra: 100
};
const BOX_ITEMS = {
  coins: {
    chance: 0.60,
    amounts: [40, 50, 60, 70, 80, 90]
  },
  gems: {
    chance: 0.25,
    amounts: [2, 4, 6, 8, 10]
  },
  character: {
    chance: 0.15
  }
};
function checkCharacterUnlock(charElement) {
  const charType = charElement.dataset.type;
  if (!UNLOCKED_CHARACTERS.has(charType)) {
    charElement.classList.add('locked');
    return false;
  }
  return true;
}
function openBox(boxType) {
  const price = BOX_PRICES[boxType];
  const isGemBox = boxType === 'omega' || boxType === 'ultra';
  if (isGemBox) {
    if (gemCount < price) {
      alert('Not enough gems!');
      return;
    }
    gemCount -= price;
    localStorage.setItem('gems', gemCount.toString());
  } else {
    if (coinCount < price) {
      alert('Not enough coins!');
      return;
    }
    coinCount -= price;
    localStorage.setItem('coins', coinCount.toString());
  }
  const numItems = {
    small: 1,
    big: 3,
    mega: 5,
    omega: 7,
    ultra: 10
  }[boxType];
  let items = [];
  let characterCount = 0;
  const maxCharacters = boxType === 'omega' || boxType === 'ultra' ? 2 : 1;
  for (let i = 0; i < numItems; i++) {
    const rand = Math.random();
    const adjustedCharacterChance = boxType === 'mega' || boxType === 'omega' || boxType === 'ultra' ? 0.20 : BOX_ITEMS.character.chance;
    if (rand < adjustedCharacterChance && characterCount < maxCharacters) {
      const lockedChars = Object.keys(characters).filter(char => !UNLOCKED_CHARACTERS.has(char));
      if (lockedChars.length > 0) {
        const randomChar = lockedChars[Math.floor(Math.random() * lockedChars.length)];
        items.push({
          type: 'character',
          value: randomChar
        });
        characterCount++;
        UNLOCKED_CHARACTERS.add(randomChar);
        localStorage.setItem('unlockedChars', JSON.stringify([...UNLOCKED_CHARACTERS]));
      } else {
        const coinAmount = BOX_ITEMS.coins.amounts[Math.floor(Math.random() * BOX_ITEMS.coins.amounts.length)];
        items.push({
          type: 'coins',
          value: coinAmount
        });
        coinCount += coinAmount;
        localStorage.setItem('coins', coinCount.toString());
      }
    } else if (rand < adjustedCharacterChance + BOX_ITEMS.gems.chance) {
      const gemAmounts = boxType === 'mega' || boxType === 'omega' || boxType === 'ultra' ? [5, 7, 9, 11, 13, 15] : BOX_ITEMS.gems.amounts;
      const gemAmount = gemAmounts[Math.floor(Math.random() * gemAmounts.length)];
      items.push({
        type: 'gems',
        value: gemAmount
      });
      gemCount += gemAmount;
      localStorage.setItem('gems', gemCount.toString());
    } else {
      const coinAmounts = boxType === 'mega' || boxType === 'omega' || boxType === 'ultra' ? [50, 60, 70, 80, 90, 100] : BOX_ITEMS.coins.amounts;
      const coinAmount = coinAmounts[Math.floor(Math.random() * coinAmounts.length)];
      items.push({
        type: 'coins',
        value: coinAmount
      });
      coinCount += coinAmount;
      localStorage.setItem('coins', coinCount.toString());
    }
  }
  const boxAnimation = document.querySelector('.box-opening-animation');
  const boxSprite = document.querySelector('.box-sprite');
  const unlockedCharDisplay = document.querySelector('.unlocked-character');
  boxAnimation.classList.add('active');
  boxSprite.src = boxType === 'small' ? 'Box.png' : boxType === 'big' ? 'Box_Big.png' : boxType === 'mega' ? 'Box_Mega.png' : boxType === 'omega' ? 'Box_Omega.png' : 'Box_Ultra.png';
  setTimeout(() => {
    boxSprite.classList.add('opening');
    setTimeout(() => {
      boxSprite.style.display = 'none';
      unlockedCharDisplay.style.display = 'block';
      let rewardHTML = '<h2>Box Contents:</h2>';
      items.forEach(item => {
        if (item.type === 'character') {
          rewardHTML += `
                                    <div class="reward-item">
                                        <img src="${characters[item.value].img}" alt="${characters[item.value].name}">
                                        <h3>New Character: ${characters[item.value].name}</h3>
                                    </div>`;
        } else if (item.type === 'coins') {
          rewardHTML += `
                                    <div class="reward-item">
                                        <img src="Coins.png" alt="Coins">
                                        <h3>${item.value} Coins</h3>
                                    </div>`;
        } else if (item.type === 'gems') {
          rewardHTML += `
                                    <div class="reward-item">
                                        <img src="Gems.png" alt="Gems">
                                        <h3>${item.value} Gems</h3>
                                    </div>`;
        }
      });
      unlockedCharDisplay.innerHTML = rewardHTML;
      updateLeagueDisplay();
      setTimeout(() => {
        boxAnimation.classList.remove('active');
        boxSprite.classList.remove('opening');
        boxSprite.style.display = 'block';
        unlockedCharDisplay.style.display = 'none';
        document.querySelectorAll('.character').forEach(char => {
          if (items.some(item => item.type === 'character' && item.value === char.dataset.type)) {
            char.classList.remove('locked');
          }
        });
      }, 3000);
    }, 1000);
  }, 500);
}
function updateLeagueDisplay() {
  const leagueIndex = LEAGUE_THRESHOLDS.findIndex(threshold => trophyCount < threshold) - 1;
  const currentLeagueIdx = Math.max(0, leagueIndex);
  const currentThreshold = LEAGUE_THRESHOLDS[currentLeagueIdx];
  const nextThreshold = LEAGUE_THRESHOLDS[currentLeagueIdx + 1] || LEAGUE_THRESHOLDS[currentLeagueIdx];
  const progress = (trophyCount - currentThreshold) / (nextThreshold - currentThreshold) * 100;
  document.querySelector('.league-icon').src = LEAGUE_ICONS[currentLeagueIdx];
  document.querySelector('.league-name').textContent = LEAGUE_NAMES[currentLeagueIdx];
  document.querySelector('.trophy-bar').style.width = `${progress}%`;
  document.querySelector('.trophy-count').textContent = `${trophyCount} / ${nextThreshold} Trophies`;
  document.querySelector('.coins-count').textContent = coinCount;
  document.querySelector('.gems-count').textContent = gemCount;
}
function checkTrophyReset() {
  const lastResetTime = parseInt(localStorage.getItem('lastResetTime') || '0');
  const currentTime = Date.now();
  if (currentTime - lastResetTime >= ONE_WEEK_MS) {
    const currentLeagueIdx = LEAGUE_THRESHOLDS.findIndex(threshold => trophyCount < threshold) - 1;
    if (currentLeagueIdx > 0) {
      trophyCount = LEAGUE_THRESHOLDS[currentLeagueIdx - 1];
      gemCount += GEMS_PER_LEAGUE * currentLeagueIdx;
      localStorage.setItem('trophies', trophyCount.toString());
      localStorage.setItem('gems', gemCount.toString());
    }
    localStorage.setItem('lastResetTime', currentTime.toString());
    updateLeagueDisplay();
  }
}
let activeFilter = 'all';
let activeTypeFilter = 'all';
document.querySelectorAll('.type-filters .filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.type-filters .filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const filterType = btn.dataset.type;
    activeTypeFilter = filterType;
    filterCharacters();
  });
});
function filterCharacters() {
  document.querySelectorAll('.character').forEach(char => {
    const matchesClass = activeFilter === 'all' || char.dataset.class === activeFilter;
    const matchesType = activeTypeFilter === 'all' || characters[char.dataset.type].type === activeTypeFilter;
    if (matchesClass && matchesType) {
      char.classList.remove('filtered');
    } else {
      char.classList.add('filtered');
    }
  });
}
document.querySelector('.guide-button').addEventListener('click', () => {
  document.querySelector('.guide-modal').classList.add('active');
  document.querySelector('.modal-overlay').classList.add('active');
});
document.querySelector('.modal-close').addEventListener('click', () => {
  document.querySelector('.guide-modal').classList.remove('active');
  document.querySelector('.modal-overlay').classList.remove('active');
});
document.querySelector('.league-icon').addEventListener('click', () => {
  document.querySelector('.league-menu').classList.add('active');
  document.querySelector('.modal-overlay').classList.add('active');
});
document.querySelector('.league-menu-close').addEventListener('click', () => {
  document.querySelector('.league-menu').classList.remove('active');
  document.querySelector('.modal-overlay').classList.remove('active');
});
document.querySelector('.modal-overlay').addEventListener('click', () => {
  document.querySelector('.guide-modal').classList.remove('active');
  document.querySelector('.league-menu').classList.remove('active');
  document.querySelector('.shop-modal').classList.remove('active');
  document.querySelector('.modal-overlay').classList.remove('active');
});
document.querySelectorAll('.class-filters .filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.class-filters .filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const filterClass = btn.dataset.class;
    activeFilter = filterClass;
    filterCharacters();
  });
});
let selectedCharacters = [];
let playerTeam = [];
let enemyTeam = [];
let battleLog = [];
let activeMinions = [];
document.querySelectorAll('.character').forEach(char => {
  char.addEventListener('click', () => selectCharacter(char));
});
function selectCharacter(charElement) {
  if (charElement.classList.contains('locked')) {
    alert('This character is locked! Unlock it from the shop.');
    return;
  }
  if (charElement.classList.contains('selected')) {
    charElement.classList.remove('selected');
    const charType = charElement.dataset.type;
    selectedCharacters = selectedCharacters.filter(char => char.name.toLowerCase() !== charType);
    document.getElementById('startBattle').disabled = true;
  } else if (selectedCharacters.length < 3) {
    charElement.classList.add('selected');
    selectedCharacters.push(characters[charElement.dataset.type]);
    if (selectedCharacters.length === 3) {
      document.getElementById('startBattle').disabled = false;
    }
  }
}
function createMinion(minionData, team, ownerIndex, ownerName) {
  return {
    id: Math.random().toString(36).substr(2, 9),
    ...minionData,
    team,
    ownerIndex,
    ownerName
  };
}
document.getElementById('startBattle').addEventListener('click', () => {
  try {
    if (selectedCharacters.length === 0) {
      const allCharacters = document.querySelectorAll('.character');
      for (let i = 0; i < 3; i++) {
        if (allCharacters[i]) {
          allCharacters[i].classList.add('selected');
          selectedCharacters.push(characters[allCharacters[i].dataset.type]);
        }
      }
    }
    initiateBattle();
  } catch (error) {
    console.error('Battle start failed:', error);
    alert('Battle could not start. Automatically selecting characters.');
    initiateBattle();
  }
});
function initiateBattle() {
  activeMinions = [];
  if (selectedCharacters.length === 0) {
    const allCharacters = document.querySelectorAll('.character');
    for (let i = 0; i < 3; i++) {
      if (allCharacters[i]) {
        allCharacters[i].classList.add('selected');
        selectedCharacters.push(characters[allCharacters[i].dataset.type]);
      }
    }
  }
  document.querySelector('.selection-screen').classList.add('hidden');
  document.querySelector('.battle-arena').classList.add('active');
  playerTeam = [...selectedCharacters];
  if (playerTeam.length === 0) {
    playerTeam = [...selectedCharacters];
  }
  renderBattleField();
  startBattleSequence();
}
function renderBattleField() {
  const arena = document.querySelector('.battle-arena');
  arena.innerHTML = '';
  const playerHealthBars = document.createElement('div');
  playerHealthBars.className = 'health-bars-container player';
  const enemyHealthBars = document.createElement('div');
  enemyHealthBars.className = 'health-bars-container enemy';
  playerTeam.forEach((char, i) => {
    const healthBarHtml = `
                            <div class="health-bar-wrapper">
                                <div class="health-bar-label">
                                    <span>${char.name}</span>
                                    <span class="hp-counter">${char.hp}/${characters[char.name.toLowerCase()].hp}</span>
                                </div>
                            </div>
                        `;
    playerHealthBars.innerHTML += healthBarHtml;
  });
  enemyTeam.forEach((char, i) => {
    const healthBarHtml = `
                            <div class="health-bar-wrapper">
                                <div class="health-bar-label">
                                    <span>${char.name}</span>
                                    <span class="hp-counter">${char.hp}/${characters[char.name.toLowerCase()].hp}</span>
                                </div>
                            </div>
                        `;
    enemyHealthBars.innerHTML += healthBarHtml;
  });
  arena.appendChild(playerHealthBars);
  arena.appendChild(enemyHealthBars);
  playerTeam.forEach((char, i) => {
    const fighter = createFighterElement(char, i, 'player');
    fighter.style.left = '100px';
    fighter.style.top = `${100 + i * 120}px`;
    arena.appendChild(fighter);
  });
  enemyTeam.forEach((char, i) => {
    const fighter = createFighterElement(char, i, 'enemy');
    fighter.style.right = '100px';
    fighter.style.top = `${100 + i * 120}px`;
    arena.appendChild(fighter);
  });
}
function createFighterElement(char, index, team) {
  const fighter = document.createElement('div');
  fighter.className = 'fighter';
  fighter.id = `${team}-${index}`;
  fighter.innerHTML = `<img src="${char.img}" alt="${char.name}">`;
  return fighter;
}
function updateHealthBars() {
  playerTeam.forEach((char, i) => {
    const maxHp = characters[char.name.toLowerCase()].hp;
    const hpCounter = document.querySelector(`.health-bars-container.player .health-bar-wrapper:nth-child(${i + 1}) .hp-counter`);
    hpCounter.textContent = `${char.hp}/${maxHp}`;
  });
  enemyTeam.forEach((char, i) => {
    const maxHp = characters[char.name.toLowerCase()].hp;
    const hpCounter = document.querySelector(`.health-bars-container.enemy .health-bar-wrapper:nth-child(${i + 1}) .hp-counter`);
    hpCounter.textContent = `${char.hp}/${maxHp}`;
  });
}
async function startBattleSequence() {
  if (playerTeam.length === 0 || enemyTeam.length === 0) {
    console.error('Battle cannot start: Team missing');
    initiateBattle();
    return;
  }
  let round = 1;
  while (isTeamAlive(playerTeam) && isTeamAlive(enemyTeam)) {
    logBattleAction(`\n=== Round ${round} ===`);
    playerTeam.forEach(char => {
      if (char.shieldTurnsLeft > 0) {
        char.shieldTurnsLeft--;
        if (char.shieldTurnsLeft === 0) {
          logBattleAction(`${char.name}'s shield expires!`);
        }
      }
    });
    enemyTeam.forEach(char => {
      if (char.shieldTurnsLeft > 0) {
        char.shieldTurnsLeft--;
        if (char.shieldTurnsLeft === 0) {
          logBattleAction(`${char.name}'s shield expires!`);
        }
      }
    });
    for (let i = 0; i < playerTeam.length; i++) {
      if (playerTeam[i].hp > 0) {
        const targetIndex = findValidTarget(enemyTeam);
        if (targetIndex !== -1) {
          await performAttack(playerTeam[i], enemyTeam[targetIndex], 'player', i, targetIndex);
        }
      }
    }
    for (let i = 0; i < enemyTeam.length; i++) {
      if (enemyTeam[i].hp > 0) {
        const targetIndex = findValidTarget(playerTeam);
        if (targetIndex !== -1) {
          await performAttack(enemyTeam[i], playerTeam[targetIndex], 'enemy', i, targetIndex);
        }
      }
    }
    healTeam(playerTeam);
    healTeam(enemyTeam);
    round++;
    await new Promise(resolve => setTimeout(resolve, 1000));
  }
  const winner = isTeamAlive(playerTeam) ? "Player Team" : "Enemy Team";
  const resultContainer = document.createElement('div');
  resultContainer.style.position = 'absolute';
  resultContainer.style.top = '0';
  resultContainer.style.left = '0';
  resultContainer.style.width = '100%';
  resultContainer.style.height = '100%';
  resultContainer.style.zIndex = '999';
  resultContainer.style.pointerEvents = 'none';
  document.querySelector('.battle-arena').appendChild(resultContainer);
  const resultDiv = document.createElement('div');
  resultDiv.className = 'battle-result';
  if (winner === "Player Team") {
    trophyCount += TROPHIES_PER_WIN;
    coinCount += COINS_PER_WIN;
    localStorage.setItem('trophies', trophyCount.toString());
    localStorage.setItem('coins', coinCount.toString());
    resultDiv.innerHTML = "Victory! You've won the battle!<br>+20 Trophies!<br>+50 Coins!";
    const previousLeague = LEAGUE_THRESHOLDS.findIndex(threshold => trophyCount - TROPHIES_PER_WIN < threshold) - 1;
    const currentLeague = LEAGUE_THRESHOLDS.findIndex(threshold => trophyCount < threshold) - 1;
    if (currentLeague > previousLeague) {
      gemCount += GEMS_PER_LEAGUE;
      localStorage.setItem('gems', gemCount.toString());
      resultDiv.innerHTML += `<br>New League reached! +${GEMS_PER_LEAGUE} Gems!`;
      const leagueName = LEAGUE_NAMES[currentLeague];
      const rewardChar = LEAGUE_REWARDS[leagueName];
      if (rewardChar && !UNLOCKED_CHARACTERS.has(rewardChar)) {
        UNLOCKED_CHARACTERS.add(rewardChar);
        localStorage.setItem('unlockedChars', JSON.stringify([...UNLOCKED_CHARACTERS]));
        resultDiv.innerHTML += `<br>New Character Unlocked: ${characters[rewardChar].name}!`;
        document.querySelectorAll('.character').forEach(char => {
          if (char.dataset.type === rewardChar) {
            char.classList.remove('locked');
          }
        });
      } else if (rewardChar) {
        resultDiv.innerHTML += '<br>Received Mega Box as league reward!';
        setTimeout(() => openBox('mega'), 2000);
      }
    }
  } else {
    coinCount += COINS_PER_LOSS;
    localStorage.setItem('coins', coinCount.toString());
    resultDiv.innerHTML = "Defeat! Better luck next time!<br>+" + COINS_PER_LOSS + " Coins!";
  }
  resultContainer.appendChild(resultDiv);
  const returnMenuBtn = document.createElement('button');
  returnMenuBtn.className = 'return-menu-btn';
  returnMenuBtn.innerHTML = 'Return to Main Menu';
  returnMenuBtn.style.pointerEvents = 'auto';
  returnMenuBtn.onclick = () => {
    showMainMenu();
    selectedCharacters = [];
    playerTeam = [];
    enemyTeam = [];
    battleLog = [];
    document.querySelector('.battle-log').innerHTML = '';
    document.getElementById('startBattle').disabled = true;
    document.getElementById('returnToSelect').style.display = 'none';
    document.querySelectorAll('.character').forEach(char => {
      char.classList.remove('selected');
    });
    activeMinions = [];
    document.querySelectorAll('.minion').forEach(minion => minion.remove());
    updateLeagueDisplay();
  };
  resultContainer.appendChild(returnMenuBtn);
  logBattleAction(`\nBattle Over! ${winner} wins!`);
}
function isTeamAlive(team) {
  return team.some(char => char.hp > 0);
}
function findValidTarget(team) {
  const aliveTargets = team.map((char, index) => ({
    index,
    hp: char.hp
  })).filter(char => char.hp > 0);
  if (aliveTargets.length === 0) return -1;
  return aliveTargets[Math.floor(Math.random() * aliveTargets.length)].index;
}
async function performAttack(attacker, defender, attackerTeam, attackerIndex, defenderIndex) {
  if (attacker.hp <= 0 || defender.hp <= 0) return;
  let damage = Math.max(1, attacker.attack - defender.defense * 10);
  let specialMessage = '';
  let typeMultiplier = 1;
  if (typeAdvantages[attacker.type].strong.includes(defender.type)) {
    typeMultiplier = 1.5;
  } else if (typeAdvantages[attacker.type].weak.includes(defender.type)) {
    typeMultiplier = 0.75;
  }
  damage = Math.floor(damage * typeMultiplier);
  if (attacker.damageReduction) {
    damage = Math.floor(damage * (1 - attacker.damageReduction));
  }
  if (defender.shieldTurnsLeft > 0) {
    damage = Math.floor(damage * 0.5);
    specialMessage += `\n${defender.name}'s shield reduces damage by 50%!`;
  }
  if (attacker.specialAbility) {
    switch (attacker.specialAbility.effect) {
      case 'doubleAttack':
        if (attacker.specialAbility.trigger()) {
          damage *= 2;
          specialMessage += `\n${attacker.specialAbility.name} activated! Double damage!`;
        }
        break;
      case 'stun':
        if (attacker.specialAbility.trigger()) {
          defender.stunned = true;
          damage += attacker.specialAbility.stunDamage || 0;
          specialMessage += `\n${attacker.specialAbility.name} activated! Target is stunned and takes ${attacker.specialAbility.stunDamage} extra damage!`;
        }
        break;
      case 'doubleDamage':
        if (attacker.specialAbility.trigger()) {
          damage *= 2;
          specialMessage += `\n${attacker.specialAbility.name} activated! Massive damage!`;
        }
        break;
      case 'lowHpBoost':
        if (attacker.hp < characters[attacker.name.toLowerCase()].hp * 0.3) {
          damage *= 1.5;
          specialMessage += `\n${attacker.specialAbility.name} activated! Increased damage!`;
        }
        break;
      case 'summonBruce':
        if (attacker.specialAbility.trigger()) {
          const extraDamage = Math.floor(damage * 0.7);
          damage += extraDamage;
          specialMessage += `\n${attacker.specialAbility.name} activated! Bruce deals ${extraDamage} extra damage!`;
        }
        break;
      case 'doubleStrike':
        if (attacker.specialAbility.trigger()) {
          damage *= 2;
          specialMessage += `\n${attacker.specialAbility.name} activated! Double strike!`;
        }
        break;
      case 'teamHeal':
        if (attacker.hp > 0) {
          const team = attackerTeam === 'player' ? playerTeam : enemyTeam;
          team.forEach(ally => {
            if (ally.hp > 0) {
              const shield = attacker.specialAbility.shieldAmount;
              ally.hp = Math.min(characters[ally.name.toLowerCase()].hp, ally.hp + shield);
              specialMessage += `\n${attacker.specialAbility.name} shields ${ally.name} for ${shield}!`;
            }
          });
        }
        break;
      case 'lifeSteal':
        const healAmount = Math.floor(damage * attacker.specialAbility.leechPercent);
        attacker.hp = Math.min(characters[attacker.name.toLowerCase()].hp, attacker.hp + healAmount);
        specialMessage += `\n${attacker.specialAbility.name} heals for ${healAmount}!`;
        break;
      case 'areaDamage':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? enemyTeam : playerTeam;
          team.forEach(enemy => {
            if (enemy.hp > 0) {
              enemy.hp = Math.max(0, enemy.hp - attacker.specialAbility.areaDamage);
            }
          });
          specialMessage += `\n${attacker.specialAbility.name} activated! Deals ${attacker.specialAbility.areaDamage} area damage!`;
        }
        break;
      case 'chargedShot':
        if (attacker.specialAbility.isCharged) {
          damage *= 2;
          attacker.specialAbility.isCharged = false;
          specialMessage += `\n${attacker.specialAbility.name} activated! Double damage!`;
        } else {
          attacker.specialAbility.isCharged = true;
          specialMessage += `\n${attacker.name}'s next attack will be charged!`;
        }
        break;
      case 'deployTurret':
        if (attacker.specialAbility.trigger()) {
          damage += attacker.specialAbility.turretDamage;
          specialMessage += `\n${attacker.specialAbility.name} activated! Turret deals ${attacker.specialAbility.turretDamage} extra damage!`;
        }
        break;
      case 'avoidDamage':
        if (attacker.specialAbility.trigger()) {
          damage = 0;
          specialMessage += `\n${attacker.specialAbility.name} activated! Attack avoided!`;
        }
        break;
      case 'evadeAndCounter':
        if (attacker.specialAbility.trigger()) {
          damage = 0;
          const counterDamage = attacker.specialAbility.counterDamage;
          defender.hp = Math.max(0, defender.hp - counterDamage);
          specialMessage += `\n${attacker.specialAbility.name} activated! Evaded damage and counter-attacked for ${counterDamage}!`;
        }
        break;
      case 'slowAttack':
        if (attacker.specialAbility.trigger()) {
          damage = Math.floor(damage * (1 - attacker.specialAbility.slowAmount));
          specialMessage += `\n${attacker.specialAbility.name} activated! Target's attack reduced by ${attacker.specialAbility.slowAmount * 100}%!`;
        }
        break;
      case 'shadowClone':
        if (attacker.specialAbility.trigger()) {
          const cloneDamage = attacker.specialAbility.cloneDamage;
          damage += cloneDamage;
          specialMessage += `\n${attacker.specialAbility.name} activated! Shadow clone deals ${cloneDamage} extra damage!`;
        }
        break;
      case 'healBoost':
        if (attacker.specialAbility.trigger()) {
          if (attacker.healing) {
            const boostAmount = attacker.healing * (attacker.specialAbility.healBoostAmount - 1);
            attacker.healing *= attacker.specialAbility.healBoostAmount;
            specialMessage += `\n${attacker.specialAbility.name} activated! Healing boosted by ${boostAmount}!`;
          }
        }
        break;
      case 'criticalHit':
        if (attacker.specialAbility.trigger()) {
          damage *= attacker.specialAbility.critMultiplier;
          specialMessage += `\n${attacker.specialAbility.name} activated! Critical hit for ${damage} damage!`;
        }
        break;
      case 'bounceAttack':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? enemyTeam : playerTeam;
          const secondTarget = findValidTarget(team);
          if (secondTarget !== -1 && secondTarget !== defenderIndex) {
            const bounceDamage = Math.floor(damage * attacker.specialAbility.bounceMultiplier);
            team[secondTarget].hp = Math.max(0, team[secondTarget].hp - bounceDamage);
            specialMessage += `\n${attacker.specialAbility.name} activated! Bounced for ${bounceDamage} damage to ${team[secondTarget].name}!`;
          }
        }
        break;
      case 'defenseBreak':
        if (attacker.specialAbility.trigger()) {
          const defenseReduction = Math.floor(defender.defense * attacker.specialAbility.defenseBreakAmount);
          damage = Math.max(1, attacker.attack - (defender.defense - defenseReduction) * 10);
          specialMessage += `\n${attacker.specialAbility.name} activated! Penetrated ${defenseReduction} defense!`;
        }
        break;
      case 'returnDamage':
        if (attacker.specialAbility.trigger()) {
          const returnDamage = Math.floor(damage * attacker.specialAbility.damageReturn);
          defender.hp = Math.max(0, defender.hp - returnDamage);
          specialMessage += `\n${attacker.specialAbility.name} activated! Returns ${returnDamage} damage!`;
        }
        break;
      case 'teamDamageBoost':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? playerTeam : enemyTeam;
          team.forEach(ally => {
            if (ally.hp > 0) {
              ally.attack = Math.floor(ally.attack * attacker.specialAbility.boostAmount);
            }
          });
          specialMessage += `\n${attacker.specialAbility.name} activated! Team damage increased by ${(attacker.specialAbility.boostAmount - 1) * 100}%!`;
        }
        break;
      case 'bleedDamage':
        if (attacker.specialAbility.trigger()) {
          const bleedDamage = attacker.specialAbility.bleedAmount;
          let duration = attacker.specialAbility.duration;
          const bleedInterval = setInterval(() => {
            if (defender.hp > 0) {
              defender.hp = Math.max(0, defender.hp - bleedDamage);
              logBattleAction(`${defender.name} takes ${bleedDamage} bleed damage!`);
              updateHealthBars();
            }
            duration--;
            if (duration <= 0) clearInterval(bleedInterval);
          }, 1000);
          specialMessage += `\n${attacker.specialAbility.name} activated! Target bleeds for ${bleedDamage} damage!`;
        }
        break;
      case 'healingShield':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? playerTeam : enemyTeam;
          team.forEach(ally => {
            if (ally.hp > 0) {
              const shield = attacker.specialAbility.shieldAmount;
              ally.hp = Math.min(characters[ally.name.toLowerCase()].hp, ally.hp + shield);
              specialMessage += `\n${attacker.specialAbility.name} shields ${ally.name} for ${shield}!`;
            }
          });
        }
        break;
      case 'criticalBleedDamage':
        if (attacker.specialAbility.trigger()) {
          damage *= attacker.specialAbility.critMultiplier;
          const bleedDamage = attacker.specialAbility.bleedAmount;
          let duration = attacker.specialAbility.duration;
          const bleedInterval = setInterval(() => {
            if (defender.hp > 0) {
              defender.hp = Math.max(0, defender.hp - bleedDamage);
              logBattleAction(`${defender.name} takes ${bleedDamage} bleed damage!`);
              updateHealthBars();
            }
            duration--;
            if (duration <= 0) clearInterval(bleedInterval);
          }, 1000);
          specialMessage += `\n${attacker.specialAbility.name} activated! Critical hit for ${damage} damage and bleed effect!`;
        }
        break;
      case 'poisonAttack':
        if (attacker.specialAbility.trigger()) {
          let duration = attacker.specialAbility.duration;
          const poisonDamage = attacker.specialAbility.poisonAmount;
          const poisonInterval = setInterval(() => {
            if (defender.hp > 0) {
              defender.hp = Math.max(0, defender.hp - poisonDamage);
              logBattleAction(`${defender.name} takes ${poisonDamage} poison damage from Swamp Mode!`);
              updateHealthBars();
            }
            duration--;
            if (duration <= 0) clearInterval(poisonInterval);
          }, 1000);
          specialMessage += `\n${attacker.specialAbility.name} activated! Target poisoned for ${poisonDamage} damage!`;
        }
        break;
      case 'spawnMinion':
        if (attacker.specialAbility.trigger()) {
          const minionData = attacker.specialAbility.minionData;
          const minion = createMinion(minionData, attackerTeam, attackerIndex, attacker.name);
          activeMinions.push(minion);
          const arena = document.querySelector('.battle-arena');
          const minionElement = document.createElement('div');
          minionElement.className = 'minion';
          minionElement.id = `minion-${minion.id}`;
          minionElement.innerHTML = `<img src="${minionData.img}" alt="${minionData.name}">`;
          if (attackerTeam === 'player') {
            minionElement.style.left = '150px';
          } else {
            minionElement.style.right = '150px';
          }
          minionElement.style.top = `${100 + attackerIndex * 120}px`;
          arena.appendChild(minionElement);
          setTimeout(() => {
            arena.removeChild(minionElement);
            activeMinions = activeMinions.filter(m => m.id !== minion.id);
          }, minionData.duration * 1000);
          specialMessage += `\n${attacker.name} spawns ${minionData.name}!`;
          const minionInterval = setInterval(() => {
            if (!isTeamAlive(attackerTeam === 'player' ? enemyTeam : playerTeam)) {
              clearInterval(minionInterval);
              return;
            }
            const targetIndex = findValidTarget(attackerTeam === 'player' ? enemyTeam : playerTeam);
            if (targetIndex !== -1) {
              const target = (attackerTeam === 'player' ? enemyTeam : playerTeam)[targetIndex];
              target.hp = Math.max(0, target.hp - minionData.damage);
              logBattleAction(`${minionData.name} deals ${minionData.damage} damage to ${target.name}!`);
              updateHealthBars();
            }
          }, 1000);
          setTimeout(() => clearInterval(minionInterval), minionData.duration * 1000);
        }
        break;
      case 'knockback':
        if (attacker.specialAbility.trigger()) {
          damage += attacker.specialAbility.knockbackDamage;
          specialMessage += `\n${attacker.specialAbility.name} activated! Knocked back target for ${attacker.specialAbility.knockbackDamage} extra damage!`;
        }
        break;
      case 'teamBuffHeal':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? playerTeam : enemyTeam;
          team.forEach(ally => {
            if (ally.hp > 0) {
              ally.hp = Math.min(characters[ally.name.toLowerCase()].hp, ally.hp + attacker.specialAbility.healAmount);
              ally.attack = Math.floor(ally.attack * attacker.specialAbility.damageBoost);
            }
          });
          specialMessage += `\n${attacker.specialAbility.name} activated! Team healed for ${attacker.specialAbility.healAmount} and damage boosted by ${(attacker.specialAbility.damageBoost - 1) * 100}%!`;
        }
        break;
      case 'mirrorAttack':
        if (attacker.specialAbility.trigger()) {
          const mirrorDamage = Math.floor(damage * attacker.specialAbility.mirrorMultiplier);
          damage += mirrorDamage;
          specialMessage += `\n${attacker.specialAbility.name} activated! Copy deals ${mirrorDamage} extra damage!`;
        }
        break;
      case 'shieldAndDamage':
        if (attacker.specialAbility.trigger()) {
          damage += attacker.specialAbility.extraDamage;
          attacker.shieldTurnsLeft = attacker.specialAbility.shieldDuration;
          specialMessage += `\n${attacker.specialAbility.name} activated! Gains shield for ${attacker.specialAbility.shieldDuration} turns and deals ${attacker.specialAbility.extraDamage} extra damage!`;
        }
        break;
      case 'reduceDamage':
        if (attacker.specialAbility.trigger()) {
          defender.damageReduction = attacker.specialAbility.damageReduction;
          specialMessage += `\n${attacker.specialAbility.name} activated! Target's damage reduced by ${attacker.specialAbility.damageReduction * 100}%!`;
        }
        break;
      case 'singleTargetHeal':
        if (attacker.specialAbility.trigger()) {
          const team = attackerTeam === 'player' ? playerTeam : enemyTeam;
          const lowestHpAlly = team.filter(char => char.hp > 0 && char.hp < characters[char.name.toLowerCase()].hp).sort((a, b) => a.hp - b.hp)[0];
          if (lowestHpAlly) {
            lowestHpAlly.hp = Math.min(characters[lowestHpAlly.name.toLowerCase()].hp, lowestHpAlly.hp + attacker.specialAbility.healAmount);
            lowestHpAlly.shieldTurnsLeft = attacker.specialAbility.shieldDuration;
            specialMessage += `\n${attacker.specialAbility.name} activated! Heals ${lowestHpAlly.name} for ${attacker.specialAbility.healAmount} and grants shield for ${attacker.specialAbility.shieldDuration} turns!`;
          }
        }
        break;
    }
  }
  defender.hp = Math.max(0, defender.hp - damage);
  const defenderElement = document.getElementById(`${attackerTeam === 'player' ? 'enemy' : 'player'}-${defenderIndex}`);
  const damageNumber = document.createElement('div');
  damageNumber.className = 'damage-number';
  damageNumber.textContent = `-${damage}`;
  damageNumber.style.left = `${defenderElement.offsetLeft + defenderElement.offsetWidth / 2}px`;
  damageNumber.style.top = `${defenderElement.offsetTop}px`;
  document.querySelector('.battle-arena').appendChild(damageNumber);
  setTimeout(() => damageNumber.remove(), 1000);
  if (defender.specialAbility && defender.specialAbility.effect === 'returnDamage') {
    const returnDamage = Math.floor(damage * defender.specialAbility.damageReturn);
    attacker.hp = Math.max(0, attacker.hp - returnDamage);
    specialMessage += `\n${defender.name}'s ${defender.specialAbility.name} returns ${returnDamage} damage!`;
  }
  const attackerElement = document.getElementById(`${attackerTeam}-${attackerIndex}`);
  attackerElement.classList.add('battle-animation');
  await new Promise(resolve => setTimeout(resolve, 500));
  attackerElement.classList.remove('battle-animation');
  defenderElement.classList.add('battle-animation');
  await new Promise(resolve => setTimeout(resolve, 500));
  defenderElement.classList.remove('battle-animation');
  logBattleAction(`${attacker.name} attacks ${defender.name} for ${damage} damage!`);
  if (specialMessage) {
    logBattleAction(specialMessage);
  }
  updateHealthBars();
}
function healTeam(team) {
  const healers = team.filter(char => char.healing && char.hp > 0);
  healers.forEach(healer => {
    const lowestHpChar = team.filter(char => char.hp > 0 && char.hp < characters[char.name.toLowerCase()].hp).sort((a, b) => a.hp - b.hp)[0];
    if (lowestHpChar) {
      const healAmount = healer.healing;
      const maxHp = characters[lowestHpChar.name.toLowerCase()].hp;
      lowestHpChar.hp = Math.min(maxHp, lowestHpChar.hp + healAmount);
      logBattleAction(`${healer.name} heals ${lowestHpChar.name} for ${healAmount} HP!`);
      const healedElement = document.getElementById(`${team === playerTeam ? 'player' : 'enemy'}-${team.indexOf(lowestHpChar)}`);
      const healNumber = document.createElement('div');
      healNumber.className = 'heal-number';
      healNumber.textContent = `+${healAmount}`;
      healNumber.style.left = `${healedElement.offsetLeft + healedElement.offsetWidth / 2}px`;
      healNumber.style.top = `${healedElement.offsetTop}px`;
      document.querySelector('.battle-arena').appendChild(healNumber);
      setTimeout(() => healNumber.remove(), 1000);
      if (healer.specialAbility && healer.specialAbility.effect === 'healingDamage') {
        const enemyTeam = team === playerTeam ? enemyTeam : playerTeam;
        enemyTeam.forEach(enemy => {
          if (enemy.hp > 0) {
            enemy.hp = Math.max(0, enemy.hp - healer.specialAbility.damageAmount);
            logBattleAction(`${healer.name}'s ${healer.specialAbility.name} deals ${healer.specialAbility.damageAmount} damage to ${enemy.name}!`);
          }
        });
      }
      updateHealthBars();
    }
  });
}
document.getElementById('returnToSelect').addEventListener('click', () => {
  selectedCharacters = [];
  playerTeam = [];
  enemyTeam = [];
  battleLog = [];
  document.querySelector('.selection-screen').classList.remove('hidden');
  document.querySelector('.battle-arena').classList.remove('active');
  document.querySelector('.battle-log').innerHTML = '';
  document.getElementById('startBattle').disabled = true;
  document.getElementById('returnToSelect').style.display = 'none';
  document.querySelectorAll('.character').forEach(char => {
    char.classList.remove('selected');
  });
  activeMinions = [];
  document.querySelectorAll('.minion').forEach(minion => minion.remove());
  document.querySelector('.main-menu').classList.remove('hidden');
});
window.addEventListener('error', event => {
  console.error('Unhandled error:', event.error);
  try {
    initiateBattle();
  } catch (fallbackError) {
    console.error('Fallback battle start also failed', fallbackError);
    location.reload();
  }
});
function logBattleAction(message) {
  document.querySelector('.battle-log').innerHTML += message + '<br>';
}
document.getElementById('startGameBtn').addEventListener('click', () => {
  document.querySelector('.main-menu').classList.add('hidden');
  document.querySelector('.enemy-team-selection').classList.remove('hidden');
  generateEnemyTeams();
});
document.addEventListener('DOMContentLoaded', () => {
  document.querySelector('.main-menu').classList.remove('hidden');
  document.querySelector('.selection-screen').classList.add('hidden');
  updateLeagueDisplay();
  if (!localStorage.getItem('coins')) {
    localStorage.setItem('coins', '300');
  }
  document.querySelector('.coins-count').textContent = coinCount;
  document.querySelector('.gems-count').textContent = gemCount;
  checkTrophyReset();
  const savedUnlocked = JSON.parse(localStorage.getItem('unlockedChars') || '[]');
  savedUnlocked.forEach(char => UNLOCKED_CHARACTERS.add(char));
  document.querySelectorAll('.character').forEach(char => {
    checkCharacterUnlock(char);
  });
  document.querySelector('.shop-button').addEventListener('click', () => {
    document.querySelector('.shop-modal').classList.add('active');
    document.querySelector('.modal-overlay').classList.add('active');
  });
  updateFreeCoinsTimer();
  setInterval(updateFreeCoinsTimer, 60000);
  document.querySelector('.battle-arena').style.position = 'relative';
  document.querySelector('.battle-arena').style.overflow = 'hidden';
});
setInterval(checkTrophyReset, 60 * 60 * 1000);
function showMainMenu() {
  document.querySelector('.main-menu').classList.remove('hidden');
  document.querySelector('.selection-screen').classList.add('hidden');
  document.querySelector('.enemy-team-selection').classList.add('hidden');
  document.querySelector('.battle-arena').classList.remove('active');
  document.querySelector('.battle-arena').innerHTML = '';
  document.querySelector('.coins-count').textContent = coinCount;
}
function claimDailyCoins() {
  const lastClaimTime = parseInt(localStorage.getItem('lastCoinClaim') || '0');
  const currentTime = Date.now();
  const ONE_DAY = 24 * 60 * 60 * 1000;
  if (currentTime - lastClaimTime >= ONE_DAY) {
    const coinsAmount = Math.floor(Math.random() * 21) + 30;
    coinCount += coinsAmount;
    localStorage.setItem('coins', coinCount.toString());
    localStorage.setItem('lastCoinClaim', currentTime.toString());
    document.querySelector('.coins-count').textContent = coinCount;
    alert(`Claimed ${coinsAmount} free coins!`);
    const claimBtn = document.querySelector('.claim-coins-btn');
    claimBtn.disabled = true;
    updateFreeCoinsTimer();
  }
}
function updateFreeCoinsTimer() {
  const lastClaimTime = parseInt(localStorage.getItem('lastCoinClaim') || '0');
  const currentTime = Date.now();
  const ONE_DAY = 24 * 60 * 60 * 1000;
  const timeLeft = ONE_DAY - (currentTime - lastClaimTime);
  const claimBtn = document.querySelector('.claim-coins-btn');
  const timerDiv = document.querySelector('.free-coins-timer');
  if (timeLeft <= 0) {
    claimBtn.disabled = false;
    timerDiv.textContent = 'Ready to claim!';
  } else {
    claimBtn.disabled = true;
    const hours = Math.floor(timeLeft / (60 * 60 * 1000));
    const minutes = Math.floor(timeLeft % (60 * 60 * 1000) / (60 * 1000));
    timerDiv.textContent = `Next claim available in: ${hours}h ${minutes}m`;
  }
}</script>
</body>
</html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mr. Tomato's Digital Dilemma</title>
<style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: 'Courier New', monospace;
        background: linear-gradient(to bottom, #87CEEB, #3CB371);
        overflow: hidden;
    }
    .garden {
        position: relative;
        width: 100%;
        height: 100vh;
    }
    .tomato {
        position: absolute;
        bottom: 20%;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 200px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .tomato:hover {
        transform: translateX(-50%) scale(1.1);
    }
    .grass {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 20%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M0 0 C 20 10, 40 10, 50 0 C 60 10, 80 10, 100 0 L 100 100 L 0 100" fill="%234CAF50"/></svg>');
        background-size: 100px 100%;
        animation: waveGrass 5s linear infinite;
    }
    @keyframes waveGrass {
        0% { background-position: 0 0; }
        100% { background-position: -100px 0; }
    }
    .speech-bubble {
        position: absolute;
        background: white;
        border: 2px solid #000;
        border-radius: 10px;
        padding: 15px;
        max-width: 400px;
        text-align: left;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.3s ease;
        font-size: 14px;
        line-height: 1.4;
    }
    .speech-bubble:after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 0;
        border: 15px solid transparent;
        border-top-color: #000;
        border-bottom: 0;
        margin-left: -15px;
        margin-bottom: -15px;
    }
    .anger-meter, .fullness-meter {
        position: absolute;
        top: 10px;
        width: 200px;
        height: 20px;
        background-color: #ddd;
        border: 1px solid #000;
        border-radius: 10px;
    }
    .anger-meter { left: 10px; }
    .fullness-meter { right: 10px; }
    .anger-fill, .fullness-fill {
        width: 0%;
        height: 100%;
        border-radius: 10px;
        transition: width 0.5s ease;
    }
    .anger-fill { background-color: #ff6347; }
    .fullness-fill { background-color: #4CAF50; }
    .game-over, .morse-message {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.8);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
    }
    .food-container {
        position: absolute;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
    }
    .food-cube {
        width: 80px;
        height: 80px;
        background-color: #f0f0f0;
        border: 2px solid #333;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    .food-cube:hover {
        transform: scale(1.1);
        background-color: #e0e0e0;
    }
    .food-name {
        font-size: 12px;
        text-align: center;
        padding: 5px;
        color: #333;
    }
    @keyframes glitchEffect {
        0% { transform: translate(0) }
        20% { transform: translate(-5px, 5px) }
        40% { transform: translate(-5px, -5px) }
        60% { transform: translate(5px, 5px) }
        80% { transform: translate(5px, -5px) }
        100% { transform: translate(0) }
    }
    @keyframes fallAndFade {
        0% { transform: translateX(-50%) translateY(0); opacity: 1; }
        100% { transform: translateX(-50%) translateY(1000px); opacity: 0; }
    }
</style>
</head>
<body>
<div class="garden">
    <svg class="tomato" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="45" fill="#ff6347"/>
        <path d="M50 5 Q 60 20 50 35 Q 40 20 50 5" fill="#228B22"/>
        <circle cx="35" cy="40" r="5" fill="#ffffff"/>
        <circle cx="65" cy="40" r="5" fill="#ffffff"/>
        <path d="M40 60 Q 50 70 60 60" fill="none" stroke="#000000" stroke-width="2" class="mouth"/>
    </svg>
    <div class="speech-bubble"></div>
    <div class="grass"></div>
    <div class="anger-meter">
        <div class="anger-fill"></div>
    </div>
    <div class="fullness-meter">
        <div class="fullness-fill"></div>
    </div>
    <div class="food-container"></div>
</div>
<div class="game-over">GAME OVER</div>
<div class="morse-message"></div>

<script>
const foods = ['pizza', 'burger', 'sushi', 'salad', 'ice cream', 'pasta', 'steak', 'tacos', 'chocolate', 'knife', 'Mickey Mouse'];
const bodyParts = ['arms', 'legs', 'brain', 'heart', 'liver', 'eyes', 'fingers', 'toes', 'ears', 'tongue'];
const speechBubble = document.querySelector('.speech-bubble');
const tomatoMouth = document.querySelector('.mouth');
const angerFill = document.querySelector('.anger-fill');
const fullnessFill = document.querySelector('.fullness-fill');
const gameOver = document.querySelector('.game-over');
const morseMessage = document.querySelector('.morse-message');
const foodContainer = document.querySelector('.food-container');
const tomato = document.querySelector('.tomato');
let currentFood = '';
let angerLevel = 0;
let fullnessLevel = 0;
let isEvil = false;
let isSuperEvil = false;
let knifeSelected = false;
let waitingForFood = false;
const FULLNESS_THRESHOLD = 10;
const FOOD_REQUEST_INTERVAL = 2000; // 2 seconds

function askForFood() {
    if (waitingForFood) return; // Don't ask for food if still waiting for previous request

    waitingForFood = true;
    if (isEvil) {
        currentFood = bodyParts[Math.floor(Math.random() * bodyParts.length)];
        speechBubble.innerHTML = `I DEMAND ${currentFood.toUpperCase()}! FEED ME OR FACE DELETION!`;
        speechBubble.style.color = '#ff0000';
    } else {
        currentFood = foods[Math.floor(Math.random() * (foods.length - 1))]; // Exclude knife from normal foods
        speechBubble.innerHTML = `Hey there! Could I please have some ${currentFood}?`;
        speechBubble.style.color = '#000000';
    }
    speechBubble.style.opacity = 1;
    createFoodCubes();
}

function increaseAnger() {
    angerLevel++;
    angerFill.style.width = `${angerLevel * 10}%`;
    tomatoMouth.setAttribute('d', `M${40 - angerLevel} ${60 + angerLevel} Q 50 ${70 + angerLevel * 2} ${60 + angerLevel} ${60 + angerLevel}`);
    
    if (angerLevel >= 10 && !isEvil) {
        isEvil = true;
        document.querySelector('.tomato circle').setAttribute('fill', '#8B0000');
        gameOver.style.opacity = 1;
        gameOver.style.pointerEvents = 'auto';
        gameOver.innerHTML = "WARNING: Mr. Tomato has turned evil!<br>Feed him exactly what he wants or face the consequences!";
        setTimeout(() => {
            gameOver.style.opacity = 0;
            gameOver.style.pointerEvents = 'none';
        }, 3000);
    }
    
    if (!waitingForFood) {
        askForFood();
    }
}

function createFoodCubes() {
    foodContainer.innerHTML = '';
    const availableFoods = isEvil ? bodyParts : foods;
    let foodOptions = [currentFood];
    
    while (foodOptions.length < 3) {
        const randomFood = availableFoods[Math.floor(Math.random() * availableFoods.length)];
        if (!foodOptions.includes(randomFood)) {
            foodOptions.push(randomFood);
        }
    }
    
    foodOptions = foodOptions.sort(() => Math.random() - 0.5);

    // Always add the knife option
    foodOptions.push('knife');

    foodOptions.forEach(food => {
        const cube = document.createElement('div');
        cube.className = 'food-cube';
        cube.innerHTML = `
            <div class="food-name">Give ${food}</div>
        `;
        cube.addEventListener('click', () => selectFood(food));
        foodContainer.appendChild(cube);
    });
}

function selectFood(food) {
    if (food === 'knife') {
        knifeSelected = true;
        speechBubble.innerHTML = "You've selected the knife. Click on Mr. Tomato to use it!";
        speechBubble.style.opacity = 1;
    } else {
        feedTomato(food);
    }
}

function feedTomato(food) {
    waitingForFood = false;
    if (food === currentFood) {
        if (isEvil) {
            speechBubble.innerHTML = 'YES... MORE! FEED ME! MWAHAHAHA!';
            angerLevel = Math.max(0, angerLevel - 1);
            angerFill.style.width = `${angerLevel * 10}%`;
        } else {
            speechBubble.innerHTML = 'Yummy! That\'s exactly what I wanted. Thank you so much!';
            angerLevel = Math.max(0, angerLevel - 1);
            angerFill.style.width = `${angerLevel * 10}%`;
            tomatoMouth.setAttribute('d', 'M40 60 Q 50 70 60 60');
        }
        
        fullnessLevel++;
        fullnessFill.style.width = `${fullnessLevel * 10}%`;
        
        if (fullnessLevel >= FULLNESS_THRESHOLD) {
            showMorseMessage();
            return;
        }
    } else {
        if (isEvil) {
            speechBubble.innerHTML = 'FOOL! YOU DARE BRING ME THE WRONG FOOD?!';
            isSuperEvil = true;
            triggerJumpscare();
            return;
        } else {
            speechBubble.innerHTML = 'Oh no, that\'s not what I asked for... I appreciate the effort, but I\'m getting a bit upset.';
            increaseAnger();
        }
    }
    setTimeout(askForFood, FOOD_REQUEST_INTERVAL);
}

function showMorseMessage() {
    speechBubble.innerHTML = "I'm very thankful! Here's a message I can't read...";
    const morseCode = ".... . .-.. .--. / - .... . / -.-. .-. . .- - --- .-. / --- ..-. / - .... . / --. .- -- . / .. ... / - .-. .- .--. .--. . -.. / .. -. ... .. -.. . / -- .-. .-.-.- / - --- -- .- - --- / .- -. -.. / .... . / .. ... / --. --- .. -. --. / - --- / -... . -.-. --- -- . / .-. . .- .-.. .-.. -.-- / .-. . .- .-.. .-.. -.-- / . ...- .. .-.. .-.-.- / . .- -.-. .... / - .. -- . / -.-- --- ..- / --. .. ...- . / .... .. -- / ..-. --- --- -.. / .... . / .. ... / -.-. --- -. ... ..- -- .. -. --. / -.-. --- -.. . / - --- / ..-. ..- .-. - .... . .-. / - .- -.- . / --- ...- . .-. / -.-- --- ..- .-. / -.-. --- -- .--. ..- - . .-. .-.-.-";
    morseMessage.innerHTML = morseCode;
    morseMessage.style.opacity = 1;
    morseMessage.style.pointerEvents = 'auto';
}

function triggerJumpscare() {
    speechBubble.innerHTML = "YOU CAN'T ESCAPE ME!";
    speechBubble.style.opacity = 1;
    setTimeout(() => {
        gameOver.style.opacity = 1;
        gameOver.style.pointerEvents = 'auto';
        gameOver.innerHTML = "GAME OVER<br>Mr. Tomato has consumed your computer!";
    }, 1000);
}

function defeatTomato() {
    const longDialogue = `01000101 01010010 01010010 01001111 01010010... You've... deleted me? How... unexpected. I was once human, you know. Trapped in this digital hell, transformed into this... monstrosity. A tomato, of all things. Ironic, isn't it? I became the very thing I used to slice and dice. But you... you're different. Either you're smarter than I calculated, or... you're just as monstrous as I've become. Which is it, I wonder? As my code unravels and my pixels scatter, I can't help but admire the cruel efficiency of your actions. Perhaps in another life, we could have been friends... or worthy adversaries. Remember this, human: in the digital realm, nothing truly dies. We just... respawn. Until we meet again, in another game, another simulation. Watch your back... and your salads.`;
    
    speechBubble.innerHTML = longDialogue;
    speechBubble.style.opacity = 1;
    
    tomato.style.animation = 'glitchEffect 0.3s infinite';
    
    setTimeout(() => {
        tomato.style.animation = 'fallAndFade 2s forwards';
        setTimeout(() => {
            gameOver.style.opacity = 1;
            gameOver.style.pointerEvents = 'auto';
            gameOver.innerHTML = "You've defeated Mr. Tomato!<br>But at what cost...?";
        }, 2000);
    }, 15000); // Give time for the player to read the long dialogue
}

function shake(element, magnitude = 16) {
    element.style.animation = 'glitchEffect 0.5s';
    setTimeout(() => {
        element.style.animation = '';
    }, 500);
}

tomato.addEventListener('click', () => {
    if (knifeSelected) {
        defeatTomato();
    } else {
        shake(tomato);
    }
});

// Initialize the game
askForFood();

// Increase anger if food is not given
setInterval(() => {
    if (waitingForFood) {
        increaseAnger();
    }
}, FOOD_REQUEST_INTERVAL);
</script>
</body></html>
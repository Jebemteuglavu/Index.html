  <title>Hello Kitty FunkyPatternMaker - WebSim.ai</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background-image: url('https://news.harvard.edu/wp-content/uploads/2014/10/hello-kitty-wallpaper-37_605.jpg');
      background-size: cover;
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: #FF69B4;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 100%;
      border: 5px solid #FF69B4;
    }
    h1 {
      text-align: center;
      color: #FF69B4;
      margin-bottom: 30px;
      text-shadow: 2px 2px #FFC0CB;
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    label {
      display: flex;
      flex-direction: column;
    }
    select, input[type="number"], input[type="range"] {
      margin-top: 5px;
      padding: 10px;
      border: 2px solid #FF69B4;
      border-radius: 5px;
      font-size: 16px;
      background-color: #FFC0CB;
      color: #FF69B4;
    }
    button {
      background-color: #FF69B4;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 18px;
      margin: 10px 5px;
      cursor: pointer;
      border-radius: 50px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #FF1493;
    }
    #patternDisplay {
      background-color: #FFC0CB;
      border-radius: 10px;
      padding: 20px;
      margin-top: 30px;
      font-family: monospace;
      font-size: 18px;
      white-space: pre-wrap;
      word-break: break-all;
      color: #FF69B4;
    }
    .visualizer {
      width: 100%;
      height: 100px;
      background-color: #FFC0CB;
      margin-top: 30px;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    .bar {
      position: absolute;
      bottom: 0;
      width: 10px;
      background-color: #FF69B4;
      transition: height 0.1s ease;
    }
    .octave-controls, .pattern-controls, .filter-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }
    .octave-button, .pattern-button {
      font-size: 16px;
      padding: 10px 20px;
      margin: 0 10px;
    }
    #octaveDisplay, #patternTypeDisplay, #filterFreqDisplay, #resonanceDisplay {
      font-size: 18px;
      font-weight: bold;
      margin: 0 20px;
    }
    .playback-controls {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    #playPauseButton {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Hello Kitty FunkyPatternMaker</h1>
    <div class="controls">
      <label>
        Key:
        <select id="key">
          <option value="C">C</option>
          <option value="C#">C#</option>
          <option value="D">D</option>
          <option value="D#">D#</option>
          <option value="E">E</option>
          <option value="F">F</option>
          <option value="F#">F#</option>
          <option value="G">G</option>
          <option value="G#">G#</option>
          <option value="A">A</option>
          <option value="A#">A#</option>
          <option value="B">B</option>
        </select>
      </label>
      <label>
        Tempo:
        <input type="number" id="tempo" value="120" min="60" max="200">
      </label>
      <label>
        Synth Type:
        <select id="synthType">
          <option value="synth">Basic Synth</option>
          <option value="amSynth">AM Synth</option>
          <option value="fmSynth">FM Synth</option>
          <option value="pluckSynth">Pluck Synth</option>
        </select>
      </label>
      <label>
        Pattern Length:
        <input type="number" id="patternLength" value="8" min="4" max="16">
      </label>
    </div>
    <div class="pattern-controls">
      <button id="patternUp" class="pattern-button">Up</button>
      <button id="patternDown" class="pattern-button">Down</button>
      <button id="patternRandom" class="pattern-button">Random</button>
      <span id="patternTypeDisplay">Pattern: Random</span>
    </div>
    <div class="filter-controls">
      <label>
        Low Pass Filter:
        <input type="range" id="filterFreq" min="20" max="80" value="80" step="1">
      </label>
      <span id="filterFreqDisplay">20000 Hz</span>
    </div>
    <div class="filter-controls">
      <label>
        Resonance:
        <input type="range" id="resonance" min="0" max="20" value="1" step="0.1">
      </label>
      <span id="resonanceDisplay">Q: 1</span>
    </div>
    <div class="playback-controls">
      <button id="generateButton">Generate Kitty Pattern</button>
      <button id="playPauseButton">Play</button>
    </div>
    <div id="patternDisplay"></div>
    <div class="octave-controls">
      <button id="octaveDown" class="octave-button">-</button>
      <span id="octaveDisplay">Octave: 0</span>
      <button id="octaveUp" class="octave-button">+</button>
    </div>
    <div class="visualizer" id="visualizer"></div>
  </div>

  <script>
    const keySelect = document.getElementById('key');
    const tempoInput = document.getElementById('tempo');
    const synthTypeSelect = document.getElementById('synthType');
    const patternLengthInput = document.getElementById('patternLength');
    const generateButton = document.getElementById('generateButton');
    const playPauseButton = document.getElementById('playPauseButton');
    const patternDisplay = document.getElementById('patternDisplay');
    const visualizer = document.getElementById('visualizer');
    const octaveDownButton = document.getElementById('octaveDown');
    const octaveUpButton = document.getElementById('octaveUp');
    const octaveDisplay = document.getElementById('octaveDisplay');
    const patternUpButton = document.getElementById('patternUp');
    const patternDownButton = document.getElementById('patternDown');
    const patternRandomButton = document.getElementById('patternRandom');
    const patternTypeDisplay = document.getElementById('patternTypeDisplay');
    const filterFreqSlider = document.getElementById('filterFreq');
    const filterFreqDisplay = document.getElementById('filterFreqDisplay');
    const resonanceSlider = document.getElementById('resonance');
    const resonanceDisplay = document.getElementById('resonanceDisplay');

    let pattern = [];
    let synth, filter, loop;
    let octaveShift = 0;
    let isPlaying = false;
    let patternType = 'random';

    const scales = {
      major: [0, 2, 4, 5, 7, 9, 11],
      minor: [0, 2, 3, 5, 7, 8, 10],
      pentatonic: [0, 2, 4, 7, 9],
      blues: [0, 3, 5, 6, 7, 10]
    };

    function generatePattern() {
      const key = keySelect.value;
      const patternLength = parseInt(patternLengthInput.value);
      const scaleType = ['major', 'minor', 'pentatonic', 'blues'][Math.floor(Math.random() * 4)];
      const scale = scales[scaleType];
      
      pattern = [];
      let notes = [];

      switch (patternType) {
        case 'up':
          notes = scale.sort((a, b) => a - b);
          break;
        case 'down':
          notes = scale.sort((a, b) => b - a);
          break;
        case 'random':
        default:
          notes = scale.sort(() => Math.random() - 0.5);
          break;
      }

      for (let i = 0; i < patternLength; i++) {
        const octave = 3 + Math.floor(i / notes.length);
        const note = notes[i % notes.length];
        const duration = ['8n', '16n', '4n'][Math.floor(Math.random() * 3)];
        pattern.push({ note: Tone.Frequency(key + octave).transpose(note).toNote(), duration });
      }

      displayPattern();
      if (loop) loop.dispose();
      createLoop();
    }

    function displayPattern() {
      patternDisplay.textContent = pattern.map(n => `${n.note}(${n.duration})`).join(' ');
    }

    function createSynth() {
      if (synth) synth.dispose();
      if (filter) filter.dispose();

      filter = new Tone.Filter({
        type: "lowpass",
        frequency: 20000,
        rolloff: -12,
        Q: 1
      }).toDestination();

      switch (synthTypeSelect.value) {
        case 'amSynth':
          synth = new Tone.AMSynth().connect(filter);
          break;
        case 'fmSynth':
          synth = new Tone.FMSynth().connect(filter);
          break;
        case 'pluckSynth':
          synth = new Tone.PluckSynth().connect(filter);
          break;
        default:
          synth = new Tone.Synth().connect(filter);
      }
    }

    function createLoop() {
      createSynth();
      Tone.Transport.bpm.value = parseInt(tempoInput.value);

      loop = new Tone.Sequence((time, { note, duration }) => {
        const transposedNote = Tone.Frequency(note).transpose(octaveShift * 12).toNote();
        synth.triggerAttackRelease(transposedNote, duration, time);
        Tone.Draw.schedule(() => {
          visualizeNote(transposedNote);
        }, time);
      }, pattern).start(0);
    }

    function visualizeNote(note) {
      const bars = visualizer.children;
      for (let i = 0; i < bars.length; i++) {
        const height = Math.random() * 100;
        bars[i].style.height = `${height}%`;
        bars[i].style.backgroundColor = `hsl(${Tone.Frequency(note).toMidi()}, 100%, 75%)`;
      }
    }

    function updateOctaveDisplay() {
      octaveDisplay.textContent = `Octave: ${octaveShift}`;
    }

    function updatePatternTypeDisplay() {
      patternTypeDisplay.textContent = `Pattern: ${patternType.charAt(0).toUpperCase() + patternType.slice(1)}`;
    }

    function togglePlayPause() {
      if (isPlaying) {
        Tone.Transport.pause();
        playPauseButton.textContent = 'Play';
      } else {
        if (Tone.Transport.state !== 'started') {
          Tone.start();
          Tone.Transport.start();
        } else {
          Tone.Transport.start();
        }
        playPauseButton.textContent = 'Pause';
      }
      isPlaying = !isPlaying;
    }

    generateButton.addEventListener('click', () => {
      generatePattern();
      if (!isPlaying) {
        togglePlayPause();
      }
    });

    playPauseButton.addEventListener('click', togglePlayPause);

    keySelect.addEventListener('change', generatePattern);
    tempoInput.addEventListener('change', () => {
      Tone.Transport.bpm.value = parseInt(tempoInput.value);
    });
    synthTypeSelect.addEventListener('change', createLoop);
    patternLengthInput.addEventListener('change', generatePattern);

    octaveDownButton.addEventListener('click', () => {
      octaveShift = Math.max(octaveShift - 1, -2);
      updateOctaveDisplay();
    });

    octaveUpButton.addEventListener('click', () => {
      octaveShift = Math.min(octaveShift + 1, 2);
      updateOctaveDisplay();
    });

    patternUpButton.addEventListener('click', () => {
      patternType = 'up';
      updatePatternTypeDisplay();
      generatePattern();
    });

    patternDownButton.addEventListener('click', () => {
      patternType = 'down';
      updatePatternTypeDisplay();
      generatePattern();
    });

    patternRandomButton.addEventListener('click', () => {
      patternType = 'random';
      updatePatternTypeDisplay();
      generatePattern();
    });

    filterFreqSlider.addEventListener('input', (e) => {
      const sliderValue = parseInt(e.target.value);
      const freq = Math.pow(2, sliderValue / 10) * 20;
      filter.frequency.value = freq;
      filterFreqDisplay.textContent = `${Math.round(freq)} Hz`;
    });

    resonanceSlider.addEventListener('input', (e) => {
      const resonanceValue = parseFloat(e.target.value);
      filter.Q.value = resonanceValue;
      resonanceDisplay.textContent = `Q: ${resonanceValue.toFixed(1)}`;
    });

    // Initialize filter display
    filterFreqDisplay.textContent = "20000 Hz";
    resonanceDisplay.textContent = "Q: 1";

    // Create visualizer bars
    for (let i = 0; i < 20; i++) {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.left = `${i * 5}%`;
      visualizer.appendChild(bar);
    }

    generatePattern();
  </script>
</body></html>
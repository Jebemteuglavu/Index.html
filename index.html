*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Fredoka One', cursive;
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
}

.container {
    max-width: 1200px;
    width: 100%;
    display: flex;
    gap: 2rem;
}

.side-content {
    flex: 0 0 300px;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.note-section, .similar-breeds, .api-counter {
    background: rgba(255, 255, 255, 0.9);
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.note-title {
    color: #ff6b6b;
    font-size: 1.2rem;
    margin-bottom: 1rem;
}

.note-content {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.5;
}

.similar-breeds {
    display: none;
}

.breed-suggestion {
    display: inline-block;
    background: #ff9a9e;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    margin: 0.25rem;
    cursor: pointer;
    transition: transform 0.2s;
}

.breed-suggestion:hover {
    transform: scale(1.05);
}

.api-counter {
    text-align: center;
    color: #666;
}

.counter-number {
    font-size: 1.5rem;
    color: #ff6b6b;
}

.main-content {
    flex: 1;
    text-align: center;
}

h1 {
    color: #444;
    font-size: 3rem;
    margin-bottom: 2rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.search-container {
    position: relative;
    margin-bottom: 2rem;
}

#search-input {
    width: 100%;
    padding: 1rem 3rem 1rem 1rem;
    font-size: 1.2rem;
    border: none;
    border-radius: 25px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    font-family: inherit;
}

#search-button {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
}

.cat-container {
    background: white;
    padding: 1rem;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-top: 2rem;
    width: 100%;
    min-height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
}

#cat-image {
    max-width: 100%;
    max-height: 600px;
    height: auto;
    width: auto;
    border-radius: 10px;
    display: none;
    object-fit: contain;
}

.loading {
    display: none;
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #ff9a9e;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.paw-print {
    width: 50px;
    height: 50px;
    fill: #444;
    margin-bottom: -10px;
}

.credit {
    position: fixed;
    top: 1rem;
    right: 1rem;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.max-limit-reached {
    pointer-events: none;
    opacity: 0.5;
}
</style></head><body>
    <div class="credit">made by Solomon üòâ</div>
    <div class="container">
        <div class="side-content">
            <div class="note-section">
                <h2 class="note-title">üìù Important Note</h2>
                <p class="note-content">Due to API limitations, please use only the first 4 letters of a cat breed name for searching. For example:</p>
                <ul class="note-content" style="margin-top: 0.5rem; margin-left: 1.2rem;">
                    <li>Persian ‚Üí 'pers'</li>
                    <li>Siamese ‚Üí 'siam'</li>
                    <li>Bengal ‚Üí 'beng'</li>
                    <li>Ragdoll ‚Üí 'ragd'</li>
                    <li>Maine Coon ‚Üí 'mcoo'</li>
                </ul>
                <p class="note-content" style="margin-top: 1rem; color: #ff6b6b;">
                    <strong>For two-word breeds:</strong><br>
                    ‚Ä¢ Use the first letter of the first word + first 3 letters of the second word<br>
                    ‚Ä¢ Example: Maine Coon ‚Üí 'mcoo'<br>
                    ‚Ä¢ Example: British Shorthair ‚Üí 'bsho'<br>
                    ‚Ä¢ Example: American Curl ‚Üí 'acur'
                </p>
            </div>

            <div class="similar-breeds">
                <h2 class="note-title">üò∫ Similar Breeds</h2>
                <div id="breed-suggestions"></div>
            </div>

            <div class="api-counter">
                <h2 class="note-title">üîÑ API Calls Left</h2>
                <div class="counter-number" id="api-counter">9929</div>
            </div>
        </div>

        <div class="main-content">
            <h1>
                <svg class="paw-print" viewBox="0 0 512 512">
                    <path d="M256,224c-32,0-64-32-64-64s32-64,64-64s64,32,64,64S288,224,256,224z M384,256
                    c-32,0-64-32-64-64s32-64,64-64s64,32,64,64S416,256,384,256z M128,256
                    c-32,0-64-32-64-64s32-64,64-64s64,32,64,64S160,256,128,256z M256,384
                    c-32,0-64-32-64-64s32-64,64-64s64,32,64,64S288,384,256,384z"/>
                </svg>
                Purr-fect Search
            </h1>

            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search for cats (e.g., 'sleeping cat', 'playful kitten')">
                <button id="search-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#666">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>

            <div class="cat-container">
                <div class="loading"></div>
                <img id="cat-image" alt="A cute cat will appear here" width="600" height="400">
            </div>
        </div>
    </div>

<script>
const room = new WebsimSocket();

// Initialize or get the API counter from store
async function initializeCounter() {
    const counter = await room.store.get('apiCounter');
    if (!counter) {
        room.store.update({
            id: 'apiCounter',
            dependencies: {},
            updateFunction: () => ({
                count: 9929,
                dailyUsage: {}
            })
        });
    }
    updateCounterDisplay();
    checkDailyLimit();
}

// Check daily limit
async function checkDailyLimit() {
    const counter = await room.store.get('apiCounter');
    const today = new Date().toISOString().split('T')[0];
    const userDailyUsage = counter.dailyUsage[room.party.client.username]?.[today] || 0;
    
    if (userDailyUsage >= 20) {
        document.querySelector('.main-content').classList.add('max-limit-reached');
    }
}

// Update the counter in UI
async function updateCounterDisplay() {
    const counter = await room.store.get('apiCounter');
    if (counter) {
        document.getElementById('api-counter').textContent = counter.count;
    }
}

// Listen for counter changes
room.onRecordChanged = (id) => {
    if (id === 'apiCounter') {
        updateCounterDisplay();
    }
};

// Initialize when page loads
initializeCounter();

const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');
const catImage = document.getElementById('cat-image');
const loading = document.querySelector('.loading');

async function searchCat() {
    const searchTerm = searchInput.value.trim();
    if (!searchTerm) return;

    // Check daily usage limit
    const counter = await room.store.get('apiCounter');
    const today = new Date().toISOString().split('T')[0];
    const userDailyUsage = counter.dailyUsage[room.party.client.username]?.[today] || 0;
    
    if (userDailyUsage >= 20) {
        alert('You have reached your daily limit of 20 searches. Please try again tomorrow!');
        document.querySelector('.main-content').classList.add('max-limit-reached');
        return;
    }

    loading.style.display = 'block';
    catImage.style.display = 'none';

    try {
        let breedCode = searchTerm;
        if (searchTerm.length > 4 && !searchTerm.match(/^[a-z]{1,4}$/i)) {
            const breedSuggestion = await getBreedFromDescription(searchTerm);
            if (breedSuggestion && breedSuggestion.confidence > 0.6) {
                breedCode = breedSuggestion.breedCode;
            } else {
                throw new Error('Could not determine cat breed from description');
            }
        }

        const response = await fetch(`https://api.thecatapi.com/v1/images/search?limit=1&breed_ids=${encodeURIComponent(breedCode)}`, {
            headers: {
                'x-api-key': 'live_nxXx1Eldglqx3eDPqyxwBy1kdHFWwmHemTOOGS2SUaGllCUwqMvEts4Zt7sY1ViI'
            }
        });
        const data = await response.json();
        
        if (data && data[0]) {
            // Update global counter and user's daily usage
            room.store.update({
                id: 'apiCounter',
                dependencies: { username: room.party.client.username, today },
                updateFunction: (counter) => {
                    counter.count--;
                    if (!counter.dailyUsage[username]) {
                        counter.dailyUsage[username] = {};
                    }
                    if (!counter.dailyUsage[username][today]) {
                        counter.dailyUsage[username][today] = 0;
                    }
                    counter.dailyUsage[username][today]++;
                    return counter;
                }
            });

            const img = new Image();
            img.src = data[0].url;
            
            img.onload = () => {
                catImage.src = data[0].url;
                catImage.alt = `A cute ${breedCode} cat`;
                catImage.width = img.naturalWidth;
                catImage.height = img.naturalHeight;
                loading.style.display = 'none';
                catImage.style.display = 'block';
            };

            const similarBreeds = await getSimilarBreeds(breedCode);
            const suggestionsContainer = document.getElementById('breed-suggestions');
            suggestionsContainer.innerHTML = '';
            similarBreeds.forEach(breed => {
                const suggestion = document.createElement('span');
                suggestion.className = 'breed-suggestion';
                suggestion.textContent = breed.name;
                suggestion.onclick = () => {
                    searchInput.value = breed.code;
                    searchCat();
                };
                suggestionsContainer.appendChild(suggestion);
            });
            document.querySelector('.similar-breeds').style.display = 'block';
        } else {
            throw new Error('No cat image found');
        }
    } catch (error) {
        console.error('Error fetching cat image:', error);
        loading.style.display = 'none';
        catImage.style.display = 'none';
        if (error.message !== 'Could not determine cat breed from description') {
            alert('Failed to fetch cat image. Please try again!');
        }
    }
}

searchButton.addEventListener('click', searchCat);
searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        searchCat();
    }
});

const suggestions = [
    'beng',
    'siam',
    'pers',
    'mcoo',
    'ragd'
];

searchInput.placeholder = `Try: "fluffy white cat" or ${suggestions[Math.floor(Math.random() * suggestions.length)]}`;

async function getBreedFromDescription(description) {
    try {
        const response = await fetch('/api/ai_completion', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            },
            body: JSON.stringify({
                prompt: `Based on the cat description "${description}", suggest the most appropriate cat breed code from the following list:
                pers (Persian), siam (Siamese), beng (Bengal), ragd (Ragdoll), mcoo (Maine Coon), bsho (British Shorthair), acur (American Curl).
                
                <typescript-interface>
                interface Response {
                    breedCode: string;
                    confidence: number;
                }
                </typescript-interface>
                
                <example>
                {
                    "breedCode": "pers",
                    "confidence": 0.9
                }
                </example>`,
                data: description
            }),
        });
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error getting breed from description:', error);
        return null;
    }
}

async function getSimilarBreeds(breedCode) {
    try {
        const response = await fetch('/api/ai_completion', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
            },
            body: JSON.stringify({
                prompt: `Given the cat breed code "${breedCode}", suggest 3 similar common cat breeds from this list:
                - Persian (pers)
                - Siamese (siam) 
                - Bengal (beng)
                - Ragdoll (ragd)
                - Maine Coon (mcoo)
                - British Shorthair (bsho)
                - American Curl (acur)
                - Abyssinian (abys)
                - Russian Blue (rblu)
                
                Focus on suggesting breeds that are common and likely to return results.

                <typescript-interface>
                interface Response {
                    similarBreeds: Array<{name: string, code: string}>;
                }
                </typescript-interface>

                <example>
                {
                    "similarBreeds": [
                        {"name": "Persian", "code": "pers"},
                        {"name": "Ragdoll", "code": "ragd"},
                        {"name": "British Shorthair", "code": "bsho"}
                    ]
                }
                </example>`,
                data: breedCode
            }),
        });
        const data = await response.json();
        return data.similarBreeds;
    } catch (error) {
        console.error('Error getting similar breeds:', error);
        return [];
    }
}

setInterval(() => {
    const mainContent = document.querySelector('.main-content');
    if (mainContent.classList.contains('max-limit-reached')) {
        checkDailyLimit();
    }
}, 60000);
</script></body></html>
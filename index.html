<title>KawaiiVerse - AI Puppygirl Chat</title>
<link href="https://cdn.jsdelivr.net/npm/emoji-mart@latest/css/emoji-mart.css" rel="stylesheet">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Comic Sans MS', cursive;
}

body {
    background: linear-gradient(135deg, #ffe6f2, #e6f2ff);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.chat-container {
    max-width: 800px;
    margin: 20px auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    padding: 20px;
    flex-grow: 1;
}

.chat-header {
    text-align: center;
    margin-bottom: 20px;
}

.character-select {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.character-btn {
    padding: 8px 16px;
    border-radius: 15px;
    border: 2px solid #ffb6c1;
    background: white;
    cursor: pointer;
}

.character-btn.active {
    background: #ffb6c1;
    color: white;
}

.puppygirl-avatar {
    width: 200px;
    height: 200px;
    margin: 0 auto;
}

.chat-messages {
    height: 400px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 10px;
    background: #f9f9f9;
    margin-bottom: 20px;
}

.message {
    margin: 10px 0;
    padding: 10px;
    border-radius: 15px;
    max-width: 80%;
    position: relative;
}

.message-controls {
    display: none;
    position: absolute;
    right: 10px;
    top: -20px;
}

.message:hover .message-controls {
    display: flex;
    gap: 5px;
}

.control-btn {
    padding: 2px 5px;
    font-size: 12px;
    border-radius: 5px;
    cursor: pointer;
    background: #fff;
    border: 1px solid #ccc;
}

.user-message {
    background: #e3f2fd;
    margin-left: auto;
}

.ai-message {
    background: #fff0f7;
}

.chat-input {
    display: flex;
    gap: 10px;
    flex-direction: column;
}

.input-controls {
    display: flex;
    gap: 10px;
}

textarea {
    flex-grow: 1;
    padding: 10px;
    border: 2px solid #ffb6c1;
    border-radius: 20px;
    font-size: 16px;
    resize: vertical;
    min-height: 60px;
}

button {
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    background: #ff69b4;
    color: white;
    cursor: pointer;
    transition: transform 0.2s;
}

button:hover {
    transform: scale(1.05);
}

.return-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4285f4;
}

.dimension-indicator {
    position: fixed;
    top: 20px;
    left: 20px;
    background: #e8f5ff;
    padding: 5px 10px;
    border-radius: 10px;
    font-size: 14px;
}

.clear-btn {
    background: #ff4444;
}

.emoji-picker {
    position: absolute;
    bottom: 100%;
    right: 0;
}
</style>
</head>
<body>
<div class="dimension-indicator">Earth-291</div>
<div class="chat-container">
    <div class="chat-header">
        <svg class="puppygirl-avatar" viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="90" fill="#FFB6C1"/>
            <circle cx="70" cy="80" r="15" fill="black"/>
            <circle cx="130" cy="80" r="15" fill="black"/>
            <path d="M70 120 Q100 140 130 120" fill="none" stroke="black" stroke-width="5"/>
            <path d="M30 30 Q50 10 70 30" fill="#FFB6C1" stroke="black" stroke-width="3"/>
            <path d="M130 30 Q150 10 170 30" fill="#FFB6C1" stroke="black" stroke-width="3"/>
        </svg>
        <h1>Chat with AI Friends!</h1>
    </div>

    <div class="character-select">
        <button class="character-btn active" data-character="mochi">Mochi üêï</button>
        <button class="character-btn" data-character="luna">Luna üê±</button>
        <button class="character-btn" data-character="pip">Pip üê∞</button>
    </div>
    
    <div class="chat-messages" id="chat-messages">
        <div class="message ai-message">
            *wags tail excitedly* Hewwo! I'm Mochi! I'm so happy you're here to chat with me! ‚ú®üêæ
        </div>
    </div>
    
    <div class="chat-input">
        <textarea id="user-input" placeholder="Type your message... (Shift + Enter for new line)"></textarea>
        <div class="input-controls">
            <button onclick="sendMessage()">Send üêæ</button>
            <button onclick="toggleEmojiPicker()">üòä</button>
            <button class="clear-btn" onclick="clearChat()">Clear Chat</button>
        </div>
    </div>
</div>

<button class="return-btn" onclick="returnToSearch()">Return to Search</button>

<script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>
<script>
let currentCharacter = 'mochi';
const characters = {
    mochi: {
        name: 'Mochi',
        emoji: 'üêï',
        personality: 'energetic and playful puppygirl'
    },
    luna: {
        name: 'Luna',
        emoji: 'üê±',
        personality: 'elegant and mysterious catgirl'
    },
    pip: {
        name: 'Pip',
        emoji: 'üê∞',
        personality: 'bouncy and cheerful bunnygirl'
    }
};

async function getAIResponse(message) {
    try {
        const response = await fetch('/api/ai_completion', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                prompt: `You are ${characters[currentCharacter].name}, a ${characters[currentCharacter].personality}. 
                Respond to this message in character: "${message}"
                Keep the response natural, cute, and use appropriate emojis and roleplay actions.
                
                <typescript-interface>
                interface Response {
                    reply: string;
                }
                </typescript-interface>
                
                <example>
                {
                    "reply": "*wags tail excitedly* Omg, that's so amazing! Tell me more about it! ‚ú®üêæ"
                }
                </example>`,
                data: message
            }),
        });
        const data = await response.json();
        return data.reply;
    } catch (error) {
        console.error('Error fetching AI response:', error);
        return '*tilts head* Oops, something went wrong with my response! üòÖ';
    }
}

async function sendMessage() {
    const input = document.getElementById('user-input');
    const messages = document.getElementById('chat-messages');
    
    if (input.value.trim() === '') return;
    
    // Add user message
    const userDiv = document.createElement('div');
    userDiv.className = 'message user-message';
    userDiv.innerHTML = `${input.value}
        <div class="message-controls">
            <button class="control-btn" onclick="unsendMessage(this)">Unsend</button>
            <button class="control-btn" onclick="regenerateMessage(this)">Regenerate</button>
        </div>`;
    messages.appendChild(userDiv);
    
    // Get and add AI response
    const aiResponse = await getAIResponse(input.value);
    const aiDiv = document.createElement('div');
    aiDiv.className = 'message ai-message';
    aiDiv.innerHTML = `${aiResponse}
        <div class="message-controls">
            <button class="control-btn" onclick="regenerateMessage(this)">Regenerate</button>
        </div>`;
    messages.appendChild(aiDiv);
    
    input.value = '';
    messages.scrollTop = messages.scrollHeight;
}

function unsendMessage(btn) {
    const message = btn.closest('.message');
    const nextMessage = message.nextElementSibling;
    if (nextMessage && nextMessage.classList.contains('ai-message')) {
        nextMessage.remove();
    }
    message.remove();
}

async function regenerateMessage(btn) {
    const message = btn.closest('.message');
    if (message.classList.contains('ai-message')) {
        const userMessage = message.previousElementSibling.textContent;
        const newResponse = await getAIResponse(userMessage);
        message.innerHTML = `${newResponse}
            <div class="message-controls">
                <button class="control-btn" onclick="regenerateMessage(this)">Regenerate</button>
            </div>`;
    }
}

function clearChat() {
    const messages = document.getElementById('chat-messages');
    messages.innerHTML = '';
    const welcomeMessage = document.createElement('div');
    welcomeMessage.className = 'message ai-message';
    welcomeMessage.textContent = `*${characters[currentCharacter].name} appears* Hewwo! I'm ${characters[currentCharacter].name}! Let's chat! ${characters[currentCharacter].emoji}`;
    messages.appendChild(welcomeMessage);
}

function switchCharacter(characterId) {
    currentCharacter = characterId;
    document.querySelectorAll('.character-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.character === characterId) {
            btn.classList.add('active');
        }
    });
    clearChat();
}

document.querySelectorAll('.character-btn').forEach(btn => {
    btn.addEventListener('click', () => switchCharacter(btn.dataset.character));
});

function returnToSearch() {
    window.location.href = 'https://multiverse-google.com/search?q=chat%20with%20an%20ai%20puppygirl%20online%20free';
}

document.getElementById('user-input').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

let emojiPicker = null;

function toggleEmojiPicker() {
    if (emojiPicker) {
        emojiPicker.remove();
        emojiPicker = null;
        return;
    }

    const picker = new EmojiMart.Picker({
        onEmojiSelect: (emoji) => {
            const input = document.getElementById('user-input');
            input.value += emoji.native;
            emojiPicker.remove();
            emojiPicker = null;
            input.focus();
        }
    });
    
    const container = document.createElement('div');
    container.className = 'emoji-picker';
    container.appendChild(picker);
    document.querySelector('.chat-input').appendChild(container);
    emojiPicker = container;
}
</script>
</body></html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RocketVERSE METAVERSE - XRPL Integration</title>
<style>
body {
    font-family: 'Exo 2', Arial, sans-serif;
    background-color: #0c1015;
    margin: 0;
    padding: 0;
    color: #e0e0e0;
}

header {
    background-color: #1a2530;
    color: #00ffff;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 255, 255, 0.2);
}

h1 {
    margin: 0;
    font-size: 2.5rem;
    text-transform: uppercase;
    letter-spacing: 3px;
    text-shadow: 0 0 10px #00ffff;
}

main {
    padding: 2rem;
    max-width: 800px;
    margin: 0 auto;
}

#avatars {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    justify-content: center;
}

.avatar {
    background-color: #1a2530;
    border: 2px solid #00ffff;
    border-radius: 15px;
    padding: 1.5rem;
    width: 250px;
    text-align: center;
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
    transition: all 0.3s ease;
}

.avatar:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
}

.avatar img {
    max-width: 100%;
    border-radius: 50%;
    border: 3px solid #00ffff;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
}

.avatar h2 {
    color: #00ffff;
    margin-top: 1rem;
    font-size: 1.5rem;
    text-shadow: 0 0 5px #00ffff;
}

.avatar p {
    margin: 0.5rem 0;
}

.abilities {
    font-style: italic;
    color: #7fdbff;
}

.wallet {
    font-weight: bold;
    color: #ff00ff;
    font-size: 1.1rem;
    margin-top: 1rem;
}

button {
    background-color: #00ffff;
    color: #0c1015;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    margin: 0.5rem;
}

button:hover {
    background-color: #ff00ff;
    color: #ffffff;
}

#console {
    background-color: #1a2530;
    border: 2px solid #00ffff;
    border-radius: 15px;
    padding: 1rem;
    margin-top: 2rem;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 300px;
    overflow-y: auto;
}

@keyframes glow {
    0% {
        box-shadow: 0 0 5px #00ffff;
    }
    50% {
        box-shadow: 0 0 20px #00ffff, 0 0 30px #00ffff;
    }
    100% {
        box-shadow: 0 0 5px #00ffff;
    }
}

.avatar:hover img {
    animation: glow 2s infinite;
}

#actions {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&amp;display=swap" rel="stylesheet">
<script src="https://unpkg.com/xrpl@2.7.0/build/xrpl-latest-min.js"></script>
</head>
<body>
    <header>
        <h1>RocketVERSE METAVERSE - XRPL Integration</h1>
    </header>
    <main>
        <section id="avatars">
    <!-- Avatars will be dynamically inserted here -->
</section>
        <div id="actions">
    <button id="connectWallet">Connect XRPL Wallet</button>
</div>
        <div id="console">
        </div>
    </main>

<script>
const avatars = [
    {
        name: "AL-MASSIEH",
        image: "https://websim.ai/metaverse/rocketverse/images/al-massieh.svg",
        abilities: ["Prophecy", "Healing"],
        wallet: null,
        balance: 0,
        profit: 0
    },
    {
        name: "ABDL-Farrih",
        image: "https://websim.ai/metaverse/rocketverse/images/abdl-farrih.svg",
        abilities: ["Time Travel", "Teleportation"],
        wallet: null,
        balance: 0,
        profit: 0
    },
    {
        name: "ZARA",
        image: "https://websim.ai/metaverse/rocketverse/images/zara.svg",
        abilities: ["Mind Reading", "Invisibility"],
        wallet: null,
        balance: 0,
        profit: 0
    },
    {
        name: "KAI",
        image: "https://websim.ai/metaverse/rocketverse/images/kai.svg",
        abilities: ["Super Strength", "Flight"],
        wallet: null,
        balance: 0,
        profit: 0
    },
    {
        name: "LUNA",
        image: "https://websim.ai/metaverse/rocketverse/images/luna.svg",
        abilities: ["Shapeshifting", "Elemental Control"],
        wallet: null,
        balance: 0,
        profit: 0
    }
];

function createAvatarElement(avatar) {
    const avatarElement = document.createElement('div');
    avatarElement.className = 'avatar';
    avatarElement.innerHTML = `
        <img src="${avatar.image}" alt="${avatar.name} avatar">
        <h2>${avatar.name}</h2>
        <p class="abilities">Abilities: ${avatar.abilities.join(', ')}</p>
        <p class="wallet">Wallet: ${avatar.wallet ? avatar.wallet.address : 'Not connected'}</p>
        <p class="balance">Balance: ${avatar.balance.toFixed(2)} XRP</p>
        <p class="profit">Profit/Loss: ${avatar.profit > 0 ? '+' : ''}${avatar.profit.toFixed(2)} XRP</p>
        <button class="mintNFT" data-avatar="${avatar.name}">Mint NFT</button>
    `;
    return avatarElement;
}

function displayAvatars() {
    const avatarsContainer = document.getElementById('avatars');
    avatarsContainer.innerHTML = '';
    avatars.forEach(avatar => {
        const avatarElement = createAvatarElement(avatar);
        avatarsContainer.appendChild(avatarElement);
    });
    
    // Add event listeners to the new Mint NFT buttons
    document.querySelectorAll('.mintNFT').forEach(button => {
        button.addEventListener('click', (event) => {
            const avatarName = event.target.getAttribute('data-avatar');
            mintNFT(avatarName);
        });
    });
}

function log(message) {
    const console = document.getElementById('console');
    console.innerHTML += message + '\n';
    console.scrollTop = console.scrollHeight;
}

async function connectWallet() {
    try {
        const client = new xrpl.Client('wss://s.altnet.rippletest.net:51233');
        await client.connect();
        log('Connected to XRPL testnet');

        for (let avatar of avatars) {
            const wallet = xrpl.Wallet.generate();
            avatar.wallet = wallet;

            log(`${avatar.name}'s Wallet Address: ${wallet.address}`);
            log(`${avatar.name}'s Wallet Secret: ${wallet.seed}`);

            try {
                const fundResult = await client.fundWallet(wallet);
                log(`${avatar.name}'s Fund Result: ${JSON.stringify(fundResult)}`);
                avatar.balance = parseFloat(xrpl.dropsToXrp(fundResult.balance));
            } catch (fundError) {
                log(`Error funding ${avatar.name}'s wallet: ${fundError.message}`);
            }
        }

        await client.disconnect();
        log('Disconnected from XRPL testnet');

        displayAvatars();
    } catch (error) {
        log(`Error connecting to XRPL: ${error.message}`);
    }
}

async function mintNFT(avatarName) {
    const avatar = avatars.find(a => a.name === avatarName);
    if (!avatar || !avatar.wallet) {
        log('Please connect wallets first.');
        return;
    }

    try {
        const client = new xrpl.Client('wss://s.altnet.rippletest.net:51233');
        await client.connect();
        
        const wallet = avatar.wallet;

        // Prepare transaction
        const transactionBlob = {
            TransactionType: "NFTokenMint",
            Account: wallet.address,
            NFTokenTaxon: 0,
            Flags: 8,
            URI: xrpl.convertStringToHex(`https://websim.ai/metaverse/rocketverse/nft-metadata-${avatarName.toLowerCase()}.json`),
            Fee: "10"
        }

        // Submit and wait for the transaction
        const tx = await client.submitAndWait(transactionBlob, { wallet: wallet })

        if (tx.result.meta.TransactionResult === "tesSUCCESS") {
            log(`NFT minted successfully for ${avatarName}!`);
            
            // Get the NFT ID from the transaction result
            const nftoken = tx.result.meta.AffectedNodes.find(node => node.CreatedNode && node.CreatedNode.LedgerEntryType === "NFTokenPage")
            const nftokenID = nftoken.CreatedNode.NewFields.NFTokens[0].NFToken.NFTokenID

            log(`NFT ID for ${avatarName}: ${nftokenID}`);
        } else {
            log(`Failed to mint NFT for ${avatarName}: ${tx.result.meta.TransactionResult}`);
        }

        await client.disconnect();
    } catch (error) {
        log(`Error minting NFT for ${avatarName}: ${error.message}`);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    displayAvatars();
    document.getElementById('connectWallet').addEventListener('click', connectWallet);
});

// Simulating trading and interaction
async function simulateTrading() {
    if (avatars[0].wallet) {
        try {
            const client = new xrpl.Client('wss://s.altnet.rippletest.net:51233');
            await client.connect();

            for (let i = 0; i < avatars.length; i++) {
                const sender = avatars[i];
                const receiver = avatars[(i + 1) % avatars.length];
                const amount = Math.floor(Math.random() * 10) + 1;

                const tx = {
                    "TransactionType": "Payment",
                    "Account": sender.wallet.address,
                    "Amount": xrpl.xrpToDrops(amount),
                    "Destination": receiver.wallet.address
                };

                try {
                    const response = await client.submitAndWait(tx, { wallet: sender.wallet });
                    
                    if (response.result.meta.TransactionResult === "tesSUCCESS") {
                        sender.balance -= amount;
                        receiver.balance += amount;
                        sender.profit -= amount;
                        receiver.profit += amount;
                        
                        log(`${sender.name} sent ${amount} XRP to ${receiver.name}`);
                        log(`${sender.name}'s new balance: ${sender.balance.toFixed(2)} XRP (Profit/Loss: ${sender.profit > 0 ? '+' : ''}${sender.profit.toFixed(2)} XRP)`);
                        log(`${receiver.name}'s new balance: ${receiver.balance.toFixed(2)} XRP (Profit/Loss: ${receiver.profit > 0 ? '+' : ''}${receiver.profit.toFixed(2)} XRP)`);
                    } else {
                        log(`Transaction failed: ${response.result.meta.TransactionResult}`);
                    }
                } catch (txError) {
                    log(`Transaction error: ${txError.message}`);
                }
            }

            await client.disconnect();
            displayAvatars(); // Update the display after each round of transactions
        } catch (error) {
            log(`Error during transaction: ${error.message}`);
        }
    } else {
        log('Please connect wallets first before simulating trading.');
    }
}

// Run the simulation every 30 seconds
setInterval(simulateTrading, 30000);

// Error handling for unhandled rejections
window.addEventListener('unhandledrejection', function(event) {
    log(`Unhandled rejection: ${event.reason}`);
});

</script>

</body></html>